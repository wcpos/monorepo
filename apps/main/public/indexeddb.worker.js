(()=>{function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(t){var n=function(t,n){if("object"!=e(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var o=r.call(t,n||"default");if("object"!=e(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(t)}(t,"string");return"symbol"==e(n)?n:n+""}function n(e,n){for(var r=0;r<n.length;r++){var o=n[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,t(o.key),o)}}function r(e,t){return r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},r(e,t)}function o(e){return o=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},o(e)}function i(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(i=function(){return!!e})()}function s(e){var t="function"==typeof Map?new Map:void 0;return s=function(e){if(null===e||!function(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return function(e,t,n){if(i())return Reflect.construct.apply(null,arguments);var o=[null];o.push.apply(o,t);var s=new(e.bind.apply(e,o));return n&&r(s,n.prototype),s}(e,arguments,o(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),r(n,e)},s(e)}var a={isDevMode:()=>!1,deepFreezeWhenDevMode:e=>e,tunnelErrorMessage:e=>"\n        RxDB Error-Code: "+e+".\n        Hint: Error messages are not included in RxDB core to reduce build size.\n        To show the full error messages and to ensure that you do not make any mistakes when using RxDB,\n        use the dev-mode plugin when you are in development mode: https://rxdb.info/dev-mode.html?console=error\n        "};function c(e,t,n){return"\n"+e+"\n"+function(e){var t="";return 0===Object.keys(e).length?t:(t+="-".repeat(20)+"\n",t+="Parameters:\n",t+=Object.keys(e).map((t=>{var n="[object Object]";try{n="errors"===t?e[t].map((e=>JSON.stringify(e,Object.getOwnPropertyNames(e)))):JSON.stringify(e[t],(function(e,t){return void 0===t?null:t}),2)}catch(e){}return t+": "+n})).join("\n"),t+="\n")}(n)}var u=function(e){function t(t,n,r={}){var o,i=c(n,0,r);return(o=e.call(this,i)||this).code=t,o.message=i,o.url=l(t),o.parameters=r,o.rxdb=!0,o}var o,i;return i=e,(o=t).prototype=Object.create(i.prototype),o.prototype.constructor=o,r(o,i),t.prototype.toString=function(){return this.message},function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(t,[{key:"name",get:function(){return"RxError ("+this.code+")"}},{key:"typeError",get:function(){return!1}}])}(s(Error));function l(e){return"https://rxdb.info/errors.html?console=errors#"+e}function f(e){return"\nFind out more about this error here: "+l(e)+" \n"}function d(e,t){return new u(e,a.tunnelErrorMessage(e)+f(e),t)}var h=/\./g,p="abcdefghijklmnopqrstuvwxyz",m=e=>{var t=typeof e;return null!==e&&("object"===t||"function"===t)},v=new Set(["__proto__","prototype","constructor"]),y=new Set("0123456789");function b(e){var t=[],n="",r="start",o=!1;for(var i of e)switch(i){case"\\":if("index"===r)throw new Error("Invalid character in an index");if("indexEnd"===r)throw new Error("Invalid character after an index");o&&(n+=i),r="property",o=!o;break;case".":if("index"===r)throw new Error("Invalid character in an index");if("indexEnd"===r){r="property";break}if(o){o=!1,n+=i;break}if(v.has(n))return[];t.push(n),n="",r="property";break;case"[":if("index"===r)throw new Error("Invalid character in an index");if("indexEnd"===r){r="index";break}if(o){o=!1,n+=i;break}if("property"===r){if(v.has(n))return[];t.push(n),n=""}r="index";break;case"]":if("index"===r){t.push(Number.parseInt(n,10)),n="",r="indexEnd";break}if("indexEnd"===r)throw new Error("Invalid character after an index");default:if("index"===r&&!y.has(i))throw new Error("Invalid character in an index");if("indexEnd"===r)throw new Error("Invalid character after an index");"start"===r&&(r="property"),o&&(o=!1,n+="\\"),n+=i}switch(o&&(n+="\\"),r){case"property":if(v.has(n))return[];t.push(n);break;case"index":throw new Error("Index was not closed");case"start":t.push("")}return t}function g(e,t){if("number"!=typeof t&&Array.isArray(e)){var n=Number.parseInt(t,10);return Number.isInteger(n)&&e[n]===e[t]}return!1}function w(e,t){var n=function(e,t,n){if(Array.isArray(t)&&(t=t.join(".")),!t.includes(".")&&!t.includes("["))return e[t];if(!m(e)||"string"!=typeof t)return void 0===n?e:n;var r=b(t);if(0===r.length)return n;for(var o=0;o<r.length;o++){var i=r[o];if(null==(e=g(e,i)?o===r.length-1?void 0:null:e[i])){if(o!==r.length-1)return n;break}}return void 0===e?n:e}(e,function(e){for(;"."===e.charAt(0);)e=e.substr(1);for(;"."===e.slice(-1);)e=e.slice(0,-1);return e}("properties."+t.replace(h,".properties.")));return n}function x(e){return"string"==typeof e?e:e.key}function S(e,t){if(!e)throw t||(t=""),new Error("ensureNotFalsy() is falsy: "+t);return e}function O(e){var t=e.split("."),n=t.length;return 1===n?t=>t[e]:e=>{for(var r=e,o=0;o<n;++o)if(void 0===(r=r[t[o]]))return r;return r}}function I(e){return Object.assign({},e)}var E=function e(t){if(!t)return t;if(null===t||"object"!=typeof t)return t;if(Array.isArray(t)){for(var n=new Array(t.length),r=n.length;r--;)n[r]=e(t[r]);return n}var o={};for(var i in t)o[i]=e(t[i]);return o};function k(e){return e[e.length-1]}function j(e){return Array.isArray(e)}function P(e,t){var n=0,r=-1;for(var o of e){if(!t(o,r+=1))break;n+=1}return n}var _=String.fromCharCode(65535),N=Number.MIN_SAFE_INTEGER;function $(e,t){var n=t.selector,r=e.indexes?e.indexes.slice(0):[];t.index&&(r=[t.index]);var o=!!t.sort.find((e=>"desc"===Object.values(e)[0])),i=new Set;Object.keys(n).forEach((t=>{var r=w(e,t);r&&"boolean"===r.type&&Object.prototype.hasOwnProperty.call(n[t],"$eq")&&i.add(t)}));var s,a=t.sort.map((e=>Object.keys(e)[0])).filter((e=>!i.has(e))).join(","),c=-1;if(r.forEach((e=>{var r=!0,u=!0,l=e.map((e=>{var t=n[e],o=t?Object.keys(t):[],i={};return t&&o.length?o.forEach((e=>{if(D.has(e)){var n=function(e,t){switch(e){case"$eq":return{startKey:t,endKey:t,inclusiveEnd:!0,inclusiveStart:!0};case"$lte":return{endKey:t,inclusiveEnd:!0};case"$gte":return{startKey:t,inclusiveStart:!0};case"$lt":return{endKey:t,inclusiveEnd:!1};case"$gt":return{startKey:t,inclusiveStart:!1};default:throw new Error("SNH")}}(e,t[e]);i=Object.assign(i,n)}})):i={startKey:u?N:_,endKey:r?_:N,inclusiveStart:!0,inclusiveEnd:!0},void 0===i.startKey&&(i.startKey=N),void 0===i.endKey&&(i.endKey=_),void 0===i.inclusiveStart&&(i.inclusiveStart=!0),void 0===i.inclusiveEnd&&(i.inclusiveEnd=!0),u&&!i.inclusiveStart&&(u=!1),r&&!i.inclusiveEnd&&(r=!1),i})),f=l.map((e=>e.startKey)),d=l.map((e=>e.endKey)),h={index:e,startKeys:f,endKeys:d,inclusiveEnd:r,inclusiveStart:u,sortSatisfiedByIndex:!o&&a===e.filter((e=>!i.has(e))).join(","),selectorSatisfiedByIndex:T(e,t.selector,f,d)},p=function(e,t,n){var r=0,o=e=>{e>0&&(r+=e)},i=10,s=P(n.startKeys,(e=>e!==N&&e!==_));o(s*i);var a=P(n.startKeys,(e=>e!==_&&e!==N));o(a*i);var c=P(n.startKeys,((e,t)=>e===n.endKeys[t]));return o(c*i*1.5),o(n.sortSatisfiedByIndex?5:0),r}(0,0,h);(p>=c||t.index)&&(c=p,s=h)})),!s)throw d("SNH",{query:t});return s}var D=new Set(["$eq","$gt","$gte","$lt","$lte"]),A=new Set(["$eq","$gt","$gte"]),M=new Set(["$eq","$lt","$lte"]);function T(e,t,n,r){var o=Object.entries(t).find((([t,n])=>!e.includes(t)||Object.entries(n).find((([e,t])=>!D.has(e)))));if(o)return!1;if(t.$and||t.$or)return!1;var i=[],s=new Set;for(var[a,c]of Object.entries(t)){if(!e.includes(a))return!1;var u=Object.keys(c).filter((e=>A.has(e)));if(u.length>1)return!1;var l=u[0];if(l&&s.add(a),"$eq"!==l){if(i.length>0)return!1;i.push(l)}}var f=[],d=new Set;for(var[h,p]of Object.entries(t)){if(!e.includes(h))return!1;var m=Object.keys(p).filter((e=>M.has(e)));if(m.length>1)return!1;var v=m[0];if(v&&d.add(h),"$eq"!==v){if(f.length>0)return!1;f.push(v)}}var y=0;for(var b of e){for(var g of[s,d]){if(!g.has(b)&&g.size>0)return!1;g.delete(b)}if(n[y]!==r[y]&&s.size>0&&d.size>0)return!1;y++}return!0}class C extends Error{}const R=Symbol("missing"),B=Object.freeze(new Error("mingo: cycle detected while processing object/array")),K=e=>{const t=pe(e);let n=0,r=t.length;for(;r;)n=(n<<5)-n^t.charCodeAt(--r);return n>>>0},L=e=>"object"!=typeof e&&"function"!=typeof e||null===e,q=e=>L(e)||Z(e)||ee(e),z={undefined:1,null:2,number:3,string:4,symbol:5,object:6,array:7,arraybuffer:8,boolean:9,date:10,regexp:11,function:12},U=(e,t)=>{e===R&&(e=void 0),t===R&&(t=void 0);const[n,r]=[e,t].map((e=>z[V(e)]));return n!==r?n-r:he(e,t)?0:e<t?-1:e>t?1:0};class F extends Map{#e=K;#t=new Map;#n=e=>{const t=this.#e(e);return[(this.#t.get(t)||[]).find((t=>he(t,e))),t]};constructor(){super()}static init(e){const t=new F;return e&&(t.#e=e),t}clear(){super.clear(),this.#t.clear()}delete(e){if(L(e))return super.delete(e);const[t,n]=this.#n(e);return!!super.delete(t)&&(this.#t.set(n,this.#t.get(n).filter((e=>!he(e,t)))),!0)}get(e){if(L(e))return super.get(e);const[t,n]=this.#n(e);return super.get(t)}has(e){if(L(e))return super.has(e);const[t,n]=this.#n(e);return super.has(t)}set(e,t){if(L(e))return super.set(e,t);const[n,r]=this.#n(e);if(super.has(n))super.set(n,t);else{super.set(e,t);const n=this.#t.get(r)||[];n.push(e),this.#t.set(r,n)}return this}get size(){return super.size}}function W(e,t){if(!e)throw new C(t)}const V=e=>{const t=Object.prototype.toString.call(e),n=t.substring(8,t.length-1).toLowerCase();if("object"!==n)return n;const r=e.constructor;return null==r||r===Object?n:r.name},H=e=>"boolean"==typeof e,J=e=>"string"==typeof e,G=e=>!isNaN(e)&&"number"==typeof e,Y=Array.isArray,Q=e=>{if(!e)return!1;const t=Object.getPrototypeOf(e);return(t===Object.prototype||null===t)&&"object"===V(e)},X=e=>!L(e),Z=e=>e instanceof Date,ee=e=>e instanceof RegExp,te=e=>"function"==typeof e,ne=e=>null==e,re=e=>ne(e)||J(e)&&!e||Y(e)&&0===e.length||Q(e)&&0===Object.keys(e).length,oe=e=>Y(e)?e:[e],ie=(e,t)=>!!e&&Object.prototype.hasOwnProperty.call(e,t),se=e=>"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView(e),ae=(e,t)=>{if(ne(e)||H(e)||G(e)||J(e))return e;if(Z(e))return new Date(e);if(ee(e))return new RegExp(e);if(se(e))return new(0,e.constructor)(e);if(t instanceof Set||(t=new Set),t.has(e))throw B;t.add(e);try{if(Y(e)){const n=new Array(e.length);for(let r=0;r<e.length;r++)n[r]=ae(e[r],t);return n}if(Q(e)){const n={};for(const r of Object.keys(e))n[r]=ae(e[r],t);return n}}finally{t.delete(e)}return e},ce=e=>e===R;function ue(e,t){if(ce(e)||ne(e))return t;if(ce(t)||ne(t))return e;if(L(e)||L(t))return t;Y(e)&&Y(t)&&W(e.length===t.length,"arrays must be of equal length to merge.");for(const n of Object.keys(t))e[n]=ue(e[n],t[n]);return e}function le(e,t=1){const n=new Array;return function e(t,r){for(let o=0,i=t.length;o<i;o++)Y(t[o])&&(r>0||r<0)?e(t[o],Math.max(-1,r-1)):n.push(t[o])}(e,t),n}const fe=Object.prototype.toString;function de(e){if(se(e))return!0;if("function"==typeof e.toString){let t=Object.getPrototypeOf(e);for(;null!==t;){if(ie(t,"toString")&&t.toString!==fe)return!0;t=Object.getPrototypeOf(t)}}return!1}function he(e,t){if(e===t||Object.is(e,t))return!0;if(null===e||null===t)return!1;if(typeof e!=typeof t)return!1;if("object"!=typeof e)return!1;if(e.constructor!==t.constructor)return!1;if(e instanceof Date)return+e==+t;if(e instanceof RegExp)return e.toString()===t.toString();const n=e.constructor;if(n===Array||n===Object){const n=Object.keys(e).sort(),r=Object.keys(t).sort();if(n.length!==r.length)return!1;for(let o=0,i=n[o];o<n.length;i=n[++o])if(i!==r[o]||!he(e[i],t[i]))return!1;return!0}return de(e)&&e.toString()===t.toString()}const pe=(e,t)=>{if(null===e)return"null";if(void 0===e)return"undefined";if(J(e)||G(e)||H(e))return JSON.stringify(e);if(Z(e))return e.toISOString();if(ee(e)||(e=>"symbol"==typeof e)(e)||te(e))return e.toString();if(se(e))return V(e)+"["+e.toString()+"]";if(t instanceof Set||(t=new Set),t.has(e))throw B;try{if(t.add(e),Y(e))return"["+e.map((e=>pe(e,t))).join(",")+"]";if(Q(e))return"{"+Object.keys(e).sort().map((n=>`${n}:${pe(e[n],t)}`)).join()+"}";if(de(e))return V(e)+"("+JSON.stringify(e.toString())+")";throw new Error("mingo: cannot stringify custom type without explicit toString() method.")}finally{t.delete(e)}};function me(e,t){return ne(e)?null:(t=t||K)(e)}function ve(e,t,n=K){if(e.length<1)return new Map;const r=new Map,o=new Map;for(let i=0;i<e.length;i++){const s=e[i],a=t(s,i),c=me(a,n);if(null===c)o.has(null)?o.get(null).push(s):o.set(null,[s]);else{const e=r.has(c)?r.get(c).find((e=>he(e,a))):null;ne(e)?(o.set(a,[s]),r.has(c)?r.get(c).push(a):r.set(c,[a])):o.get(e).push(s)}}return o}function ye(e,t){return Y(e)||Q(e)?e[t]:void 0}function be(e,t,n){let r=0;const o=q(e)?e:function e(t,n){let o=t;for(let t=0;t<n.length;t++){const i=n[t];if(null===/^\d+$/.exec(i)&&Y(o)){if(0===t&&r>0)break;r+=1;const i=n.slice(t);o=o.reduce(((t,n)=>{const r=e(n,i);return void 0!==r&&t.push(r),t}),[]);break}if(o=ye(o,i),void 0===o)break}return o}(e,t.split("."));return Y(o)&&n?.unwrapArray?function(e,t){if(t<1)return e;for(;t--&&1===e.length;)e=e[0];return e}(o,r):o}function ge(e,t,n){const r=t.indexOf("."),o=-1==r?t:t.substring(0,r),i=t.substring(r+1),s=-1!=r;if(Y(e)){const r=/^\d+$/.test(o),a=r&&n?.preserveIndex?[...e]:[];if(r){const t=parseInt(o);let r=ye(e,t);s&&(r=ge(r,i,n)),n?.preserveIndex?a[t]=r:a.push(r)}else for(const r of e){const e=ge(r,t,n);n?.preserveMissing?a.push(null==e?R:e):(null!=e||n?.preserveIndex)&&a.push(e)}return a}const a=n?.preserveKeys?{...e}:{};let c=ye(e,o);if(s&&(c=ge(c,i,n)),void 0!==c)return a[o]=c,a}function we(e){if(Y(e))for(let t=e.length-1;t>=0;t--)e[t]===R?e.splice(t,1):we(e[t]);else if(Q(e))for(const t in e)ie(e,t)&&we(e[t])}const xe=/^\d+$/;function Se(e,t,n,r){const o=t.split("."),i=o[0],s=o.slice(1).join(".");if(1===o.length)(Q(e)||Y(e)&&xe.test(i))&&n(e,i);else{r?.buildGraph&&ne(e[i])&&(e[i]={});const t=e[i];if(!t)return;const a=!!(o.length>1&&xe.test(o[1]));Y(t)&&r?.descendArray&&!a?t.forEach((e=>Se(e,s,n,r))):Se(t,s,n,r)}}function Oe(e,t,n){Se(e,t,((e,t)=>{e[t]=te(n)?n(e[t]):n}),{buildGraph:!0})}function Ie(e,t,n){Se(e,t,((e,t)=>{if(Y(e)){if(/^\d+$/.test(t))e.splice(parseInt(t),1);else if(n&&n.descendArray)for(const n of e)Q(n)&&delete n[t]}else Q(e)&&delete e[t]}),n)}const Ee=/^\$[a-zA-Z0-9_]+$/;function ke(e){return Ee.test(e)}function je(e){if(q(e))return ee(e)?{$regex:e}:{$eq:e};if(X(e)){if(!Object.keys(e).some(ke))return{$eq:e};if(ie(e,"$regex")){const t={...e};return t.$regex=new RegExp(e.$regex,e.$options),delete t.$options,t}}return e}var Pe=(e=>(e[e.CLONE_OFF=0]="CLONE_OFF",e[e.CLONE_INPUT=1]="CLONE_INPUT",e[e.CLONE_OUTPUT=2]="CLONE_OUTPUT",e[e.CLONE_ALL=3]="CLONE_ALL",e))(Pe||{});class _e{#r;#o;#i;constructor(e,t,n){this.#r=e,this.update(t,n)}static init(e,t,n){return e instanceof _e?new _e(e.#r,e.root??t,{...e.#i,...n,variables:Object.assign({},e.#i?.variables,n?.variables)}):new _e(e,t,n)}update(e,t){this.#o=e;const n=Object.assign({},this.#i?.variables,t?.variables);return Object.keys(n).length?this.#i={...t,variables:n}:this.#i=t??{},this}getOptions(){return Object.freeze({...this.#r,context:$e.from(this.#r.context)})}get root(){return this.#o}get local(){return this.#i}get idKey(){return this.#r.idKey}get collation(){return this.#r?.collation}get processingMode(){return this.#r?.processingMode||0}get useStrictMode(){return this.#r?.useStrictMode}get scriptEnabled(){return this.#r?.scriptEnabled}get useGlobalContext(){return this.#r?.useGlobalContext}get hashFunction(){return this.#r?.hashFunction}get collectionResolver(){return this.#r?.collectionResolver}get jsonSchemaValidator(){return this.#r?.jsonSchemaValidator}get variables(){return this.#r?.variables}get context(){return this.#r?.context}}var Ne=(e=>(e.ACCUMULATOR="accumulator",e.EXPRESSION="expression",e.PIPELINE="pipeline",e.PROJECTION="projection",e.QUERY="query",e.WINDOW="window",e))(Ne||{});class $e{#s=new Map;constructor(){}static init(){return new $e}static from(e){const t=$e.init();return ne(e)||e.#s.forEach(((e,n)=>t.addOperators(n,e))),t}addOperators(e,t){this.#s.has(e)||this.#s.set(e,{});for(const[n,r]of Object.entries(t))this.getOperator(e,n)||(this.#s.get(e)[n]=r);return this}getOperator(e,t){return(this.#s.get(e)??{})[t]??null}addAccumulatorOps(e){return this.addOperators("accumulator",e)}addExpressionOps(e){return this.addOperators("expression",e)}addQueryOps(e){return this.addOperators("query",e)}addPipelineOps(e){return this.addOperators("pipeline",e)}addProjectionOps(e){return this.addOperators("projection",e)}addWindowOps(e){return this.addOperators("window",e)}}const De=$e.init();function Ae(e,t){for(const[n,r]of Object.entries(t)){W(te(r)&&ke(n),`'${n}' is not a valid operator`);const t=Me(e,n,null);W(!t||r===t,`${n} already exists for '${e}' operators. Cannot change operator function once registered.`)}switch(e){case"accumulator":De.addAccumulatorOps(t);break;case"expression":De.addExpressionOps(t);break;case"pipeline":De.addPipelineOps(t);break;case"projection":De.addProjectionOps(t);break;case"query":De.addQueryOps(t);break;case"window":De.addWindowOps(t)}}function Me(e,t,n){const{context:r,useGlobalContext:o}=n||{},i=r?r.getOperator(e,t):null;return!i&&o?De.getOperator(e,t):i}function Te(e,t,n,r){const o=_e.init(r,e);return n&&ke(n)?Be(e,t,n,o):Re(e,t,o)}const Ce=["$$ROOT","$$CURRENT","$$REMOVE","$$NOW"];function Re(e,t,n){if(J(t)&&t.length>0&&"$"===t[0]){if(Ke.includes(t))return t;let r=n.root;const o=t.split(".");if(Ce.includes(o[0])){switch(o[0]){case"$$ROOT":break;case"$$CURRENT":r=e;break;case"$$REMOVE":r=void 0;break;case"$$NOW":r=new Date}t=t.slice(o[0].length+1)}else if("$$"===o[0].slice(0,2)){r=Object.assign({},n.variables,{this:e},n?.local?.variables);const i=o[0].slice(2);W(ie(r,i),`Use of undefined variable: ${i}`),t=t.slice(2)}else t=t.slice(1);return""===t?r:be(r,t)}if(Y(t))return t.map((t=>Re(e,t,n)));if(Q(t)){const r={},o=Object.entries(t);for(const[t,i]of o){if(ke(t))return W(1==o.length,"expression must have single operator."),Be(e,i,t,n);r[t]=Re(e,i,n)}return r}return t}function Be(e,t,n,r){const o=Me("expression",n,r);if(o)return o(e,t,r);const i=Me("accumulator",n,r);return W(!!i,`accumulator '${n}' is not registered.`),Y(e)||(e=Re(e,t,r),t=null),W(Y(e),`arguments must resolve to array for ${n}.`),i(e,t,r.update(null,r.local))}const Ke=["$$KEEP","$$PRUNE","$$DESCEND"];function Le(e){return e instanceof Ue?e:new Ue(e)}function qe(e,t){const n=e.slice(t+1);e.splice(t),Array.prototype.push.apply(e,n)}const ze=new Error;class Ue{constructor(e){let t;if(this.#a=[],this.#c=[],this.isDone=!1,e instanceof Function&&(e={next:e}),(n=e)&&"object"==typeof n&&n?.next instanceof Function){const n=e;t=()=>{const e=n.next();if(e.done)throw ze;return e.value}}else if(Y(e)){const n=e,r=n.length;let o=0;t=()=>{if(o<r)return n[o++];throw ze}}else if(!(e instanceof Function))throw new C("Lazy must be initialized with an array, generator, or function.");var n;this.#u=function(e,t,n){let r=!1,o=-1,i=0;return function(s){try{e:for(;!r;){let a=e();o++;let c=-1;const u=t.length;let l=!1;for(;++c<u;){const e=t[c];switch(e.action){case 0:a=e.func(a,o);break;case 1:if(!e.func(a,o))continue e;break;case 2:--e.count,e.count||(l=!0);break;case 3:--e.count,e.count||qe(t,c);continue e;default:break e}}if(r=l,!s)return{value:a,done:!1};n[i++]=a}}catch(e){if(e!==ze)throw e}return r=!0,{done:r}}}(t,this.#a,this.#c)}#a;#c;#u;push(e,t){return"function"==typeof t?this.#a.push({action:e,func:t}):"number"==typeof t&&this.#a.push({action:e,count:t}),this}next(){return this.#u()}map(e){return this.push(0,e)}filter(e){return this.push(1,e)}take(e){return e>0?this.push(2,e):this}drop(e){return e>0?this.push(3,e):this}transform(e){const t=this;let n;return Le((()=>(n||(n=Le(e(t.value()))),n.next())))}value(){return this.isDone||(this.isDone=this.#u(!0).done),this.#c}each(e){for(;;){const t=this.next();if(t.done)break;if(!1===e(t.value))return!1}return!0}reduce(e,t){let n=this.next();for(void 0!==t||n.done||(t=n.value,n=this.next());!n.done;)t=e(t,n.value),n=this.next();return t}size(){return this.reduce(((e,t)=>++e),0)}[Symbol.iterator](){return this}}const Fe=(e,t,n)=>re(t)?e:(Ve(t,n),e.map(We(t,_e.init(n))));function We(e,t,n=!0){const r=t.idKey,o=Object.keys(e),i=new Array,s=new Array,a={};for(const r of o){const o=e[r];if(G(o)||H(o))o?s.push(r):i.push(r);else if(Y(o))a[r]=e=>o.map((n=>Te(e,n,null,t.update(e))??null));else if(Q(o)){const e=Object.keys(o),i=1==e.length?e[0]:"",s=Me("projection",i,t);s?"$slice"!==i||oe(o[i]).every(G)?a[r]=e=>s(e,o[i],r,t.update(e)):a[r]=e=>Te(e,o,r,t.update(e)):ke(i)?a[r]=e=>Te(e,o[i],i,t):(Ve(o,t),a[r]=e=>{if(!ie(e,r))return Te(e,o,null,t);n&&t.update(e);const i=be(e,r),s=We(o,t,!1);return Y(i)?i.map(s):Q(i)?s(i):s(e)})}else a[r]=J(o)&&"$"===o[0]?e=>Te(e,o,r,t):e=>o}const c=Object.keys(a),u=i.includes(r);if(n&&u&&1===i.length&&!s.length&&!c.length)return e=>{const t={...e};return delete t[r],t};const l=n&&!u&&!s.includes(r),f={preserveMissing:!0};return e=>{const t={};if(i.length&&!s.length){ue(t,e);for(const e of i)Ie(t,e,{descendArray:!0})}for(const n of s)ue(t,ge(e,n,f)??{});s.length&&we(t);for(const n of c){const r=a[n](e);void 0===r?Ie(t,n,{descendArray:!0}):Oe(t,n,r)}return l&&ie(e,r)&&(t[r]=be(e,r)),t}}function Ve(e,t){let n=!1,r=!1;for(const[o,i]of Object.entries(e))W(!o.startsWith("$"),"Field names may not start with '$'."),W(!o.endsWith(".$"),"Positional projection operator '$' is not supported."),o!==t?.idKey&&(0===i||!1===i?n=!0:1!==i&&!0!==i||(r=!0),W(!(n&&r),"Projection cannot have a mix of inclusion and exclusion."))}const He=(e,t,n)=>{if(re(t)||!Q(t))return e;let r=U;const o=n.collation;return Q(o)&&J(o.locale)&&(r=function(e){const t={sensitivity:Je[e.strength||3],caseFirst:"off"===e.caseFirst?"false":e.caseFirst||"false",numeric:e.numericOrdering||!1,ignorePunctuation:"shifted"===e.alternate};!0===(e.caseLevel||!1)&&("base"===t.sensitivity&&(t.sensitivity="case"),"accent"===t.sensitivity&&(t.sensitivity="variant"));const n=new Intl.Collator(e.locale,t);return(e,t)=>{if(!J(e)||!J(t))return U(e,t);const r=n.compare(e,t);return r<0?-1:r>0?1:0}}(o)),e.transform((e=>{const o=Object.keys(t);for(const i of o.reverse()){const o=ve(e,(e=>be(e,i)),n.hashFunction),s=Array.from(o.keys()).sort(r);-1===t[i]&&s.reverse();let a=0;for(const t of s)for(const n of o.get(t))e[a++]=n;W(a==e.length,"bug: counter must match collection size.")}return e}))},Je={1:"base",2:"accent",3:"variant"},Ge={$sort:He,$skip:(e,t,n)=>e.drop(t),$limit:(e,t,n)=>e.take(t)};class Ye{#l;#f;#d;#r;#s={};#h=null;#p=[];constructor(e,t,n,r){this.#l=e,this.#f=t,this.#d=n,this.#r=r}fetch(){if(this.#h)return this.#h;this.#h=Le(this.#l).filter(this.#f);const e=this.#r.processingMode;e&Pe.CLONE_INPUT&&this.#h.map(ae);for(const e of["$sort","$skip","$limit"])ie(this.#s,e)&&(this.#h=Ge[e](this.#h,this.#s[e],this.#r));return Object.keys(this.#d).length&&(this.#h=Fe(this.#h,this.#d,this.#r)),e&Pe.CLONE_OUTPUT&&this.#h.map(ae),this.#h}fetchAll(){const e=Le([...this.#p]);return this.#p=[],function(...e){let t=0;return Le((()=>{for(;t<e.length;){const n=e[t].next();if(!n.done)return n;t++}return{done:!0}}))}(e,this.fetch())}all(){return this.fetchAll().value()}count(){return this.all().length}skip(e){return this.#s.$skip=e,this}limit(e){return this.#s.$limit=e,this}sort(e){return this.#s.$sort=e,this}collation(e){return this.#r={...this.#r,collation:e},this}next(){if(this.#p.length>0)return this.#p.pop();const e=this.fetch().next();return e.done?void 0:e.value}hasNext(){if(this.#p.length>0)return!0;const e=this.fetch().next();return!e.done&&(this.#p.push(e.value),!0)}map(e){return this.all().map(e)}forEach(e){this.all().forEach(e)}[Symbol.iterator](){return this.fetchAll()}}const Qe=new Set(Array.from(["$and","$or","$nor","$expr","$jsonSchema"]));class Xe{#m;#r;#v;constructor(e,t){this.#v=ae(e),this.#r=function(e){return e instanceof _e?e.getOptions():Object.freeze({idKey:"_id",scriptEnabled:!0,useStrictMode:!0,useGlobalContext:!0,processingMode:0,...e,context:e?.context?$e.from(e?.context):$e.init()})}(t),this.#m=[],this.compile()}compile(){W(Q(this.#v),`query criteria must be an object: ${JSON.stringify(this.#v)}`);const e={};for(const[t,n]of Object.entries(this.#v)){if("$where"===t)W(this.#r.scriptEnabled,"$where operator requires 'scriptEnabled' option to be true."),Object.assign(e,{field:t,expr:n});else if(Qe.has(t))this.processOperator(t,t,n);else{W(!ke(t),`unknown top level operator: ${t}`);for(const[e,r]of Object.entries(je(n)))this.processOperator(t,e,r)}e.field&&this.processOperator(e.field,e.field,e.expr)}}processOperator(e,t,n){const r=Me("query",t,this.#r);W(!!r,`unknown query operator ${t}`),this.#m.push(r(e,n,this.#r))}test(e){return this.#m.every((t=>t(e)))}find(e,t){return new Ye(e,(e=>this.test(e)),t||{},this.#r)}remove(e){return e.reduce(((e,t)=>(this.test(t)||e.push(t),e)),[])}}function Ze(e){return(t,n,r)=>{const o={unwrapArray:!0},i=Math.max(1,t.split(".").length-1);return s=>{const a=be(s,t,o);return e(a,n,{...r,depth:i})}}}function et(e){return(t,n,r)=>{const o=Te(t,n,null,r);return e(...o)}}function tt(e,t,n){return!!he(e,t)||!(!ne(e)||!ne(t))||!!Y(e)&&(e.some((e=>he(e,t)))||le(e,n?.depth).some((e=>he(e,t))))}function nt(e,t,n){return!tt(e,t,n)}function rt(e,t,n){return ne(e)?t.some((e=>null===e)):function(e,t=K){const n=[F.init(t),F.init(t)];if(0===e.length)return[];if(e.some((e=>0===e.length)))return[];if(1===e.length)return[...e];e[e.length-1].forEach((e=>n[0].set(e,!0)));for(let t=e.length-2;t>-1;t--){if(e[t].forEach((e=>{n[0].has(e)&&n[1].set(e,!0)})),0===n[1].size)return[];n.reverse(),n[1].clear()}return Array.from(n[0].keys())}([oe(e),t],n?.hashFunction).length>0}function ot(e,t,n){return!rt(e,t,n)}function it(e,t,n){return pt(e,t,((e,t)=>U(e,t)<0))}function st(e,t,n){return pt(e,t,((e,t)=>U(e,t)<=0))}function at(e,t,n){return pt(e,t,((e,t)=>U(e,t)>0))}function ct(e,t,n){return pt(e,t,((e,t)=>U(e,t)>=0))}function ut(e){return ke(e)&&-1===["$and","$or","$nor"].indexOf(e)}function lt(e,t,n){if(Y(e)&&!re(e)){let r=e=>e,o=t;Object.keys(t).every(ut)&&(o={temp:t},r=e=>({temp:e}));const i=new Xe(o,n);for(let t=0,n=e.length;t<n;t++)if(i.test(r(e[t])))return!0}return!1}Object.freeze({R5:[10,16,25,40,63],R10:[100,125,160,200,250,315,400,500,630,800],R20:[100,112,125,140,160,180,200,224,250,280,315,355,400,450,500,560,630,710,800,900],R40:[100,106,112,118,125,132,140,150,160,170,180,190,200,212,224,236,250,265,280,300,315,355,375,400,425,450,475,500,530,560,600,630,670,710,750,800,850,900,950],R80:[103,109,115,122,128,136,145,155,165,175,185,195,206,218,230,243,258,272,290,307,325,345,365,387,412,437,462,487,515,545,575,615,650,690,730,775,825,875,925,975],"1-2-5":[10,20,50],E6:[10,15,22,33,47,68],E12:[10,12,15,18,22,27,33,39,47,56,68,82],E24:[10,11,12,13,15,16,18,20,22,24,27,30,33,36,39,43,47,51,56,62,68,75,82,91],E48:[100,105,110,115,121,127,133,140,147,154,162,169,178,187,196,205,215,226,237,249,261,274,287,301,316,332,348,365,383,402,422,442,464,487,511,536,562,590,619,649,681,715,750,787,825,866,909,953],E96:[100,102,105,107,110,113,115,118,121,124,127,130,133,137,140,143,147,150,154,158,162,165,169,174,178,182,187,191,196,200,205,210,215,221,226,232,237,243,249,255,261,267,274,280,287,294,301,309,316,324,332,340,348,357,365,374,383,392,402,412,422,432,442,453,464,475,487,499,511,523,536,549,562,576,590,604,619,634,649,665,681,698,715,732,750,768,787,806,825,845,866,887,909,931,953,976],E192:[100,101,102,104,105,106,107,109,110,111,113,114,115,117,118,120,121,123,124,126,127,129,130,132,133,135,137,138,140,142,143,145,147,149,150,152,154,156,158,160,162,164,165,167,169,172,174,176,178,180,182,184,187,189,191,193,196,198,200,203,205,208,210,213,215,218,221,223,226,229,232,234,237,240,243,246,249,252,255,258,261,264,267,271,274,277,280,284,287,291,294,298,301,305,309,312,316,320,324,328,332,336,340,344,348,352,357,361,365,370,374,379,383,388,392,397,402,407,412,417,422,427,432,437,442,448,453,459,464,470,475,481,487,493,499,505,511,517,523,530,536,542,549,556,562,569,576,583,590,597,604,612,619,626,634,642,649,657,665,673,681,690,698,706,715,723,732,741,750,759,768,777,787,796,806,816,825,835,845,856,866,876,887,898,909,920,931,942,953,965,976,988]}),new Set(["monday","mon","tuesday","tue","wednesday","wed","thursday","thu","friday","fri","saturday","sat","sunday","sun"]),Object.freeze({mon:1,tue:2,wed:3,thu:4,fri:5,sat:6,sun:7}),Object.freeze({"%Y":{name:"year",padding:4,re:/([0-9]{4})/},"%G":{name:"year",padding:4,re:/([0-9]{4})/},"%m":{name:"month",padding:2,re:/(0[1-9]|1[012])/},"%d":{name:"day",padding:2,re:/(0[1-9]|[12][0-9]|3[01])/},"%H":{name:"hour",padding:2,re:/([01][0-9]|2[0-3])/},"%M":{name:"minute",padding:2,re:/([0-5][0-9])/},"%S":{name:"second",padding:2,re:/([0-5][0-9]|60)/},"%L":{name:"millisecond",padding:3,re:/([0-9]{3})/},"%u":{name:"weekday",padding:1,re:/([1-7])/},"%U":{name:"week",padding:2,re:/([1-4][0-9]?|5[0-3]?)/},"%V":{name:"isoWeek",padding:2,re:/([1-4][0-9]?|5[0-3]?)/},"%z":{name:"timezone",padding:2,re:/(([+-][01][0-9]|2[0-3]):?([0-5][0-9])?)/},"%Z":{name:"minuteOffset",padding:3,re:/([+-][0-9]{3})/}}),Object.freeze({});const ft=e=>null===e,dt={array:Y,boolean:H,bool:H,date:Z,number:G,int:G,long:G,double:G,decimal:G,null:ft,object:Q,regexp:ee,regex:ee,string:J,undefined:ne,function:e=>{throw new C("unsupported type key `function`.")},1:G,2:J,3:Q,4:Y,6:ne,8:H,9:Z,10:ft,11:ee,16:G,18:G,19:G};function ht(e,t,n){const r=dt[t];return!!r&&r(e)}function pt(e,t,n){return oe(e).some((e=>V(e)===V(t)&&n(e,t)))}et(ot);const mt=(e,t)=>(n,r,o)=>{W(Y(r),`${e}: expression must be an array.`);const i=Te(n,r,null,o);return i.some(ne)?null:(W(i.every(G),`${e}: expression must evalue to array of numbers.`),t(i))},vt=(mt("$bitAnd",(e=>e.reduce(((e,t)=>e&t),-1))),mt("$bitOr",(e=>e.reduce(((e,t)=>e|t),0))),mt("$bitXor",(e=>e.reduce(((e,t)=>e^t),0))),et(tt),et(at),et(ct),et(it),et(st),et(nt),(e,t)=>{const n={};return e.split("").forEach(((e,r)=>n[e]=t*(r+1))),n});vt("ABCDEFGHIKLM",1),vt("NOPQRSTUVWXY",-1);const yt={undefined:null,null:null,NaN:NaN,Infinity:new Error,"-Infinity":new Error};function bt(e,t=yt){const n=Object.assign({},yt,t),r=new Set(Object.keys(n));return(t,o,i)=>{const s=Te(t,o,null,i);if(r.has(`${s}`)){const t=n[`${s}`];if(t instanceof Error)throw new C(`cannot apply $${e.name} to -inf, value must in (-inf,inf)`);return t}return e(s)}}bt(Math.acos,{Infinity:1/0,0:new Error}),bt(Math.acosh,{Infinity:1/0,0:new Error}),bt(Math.asin),bt(Math.asinh,{Infinity:1/0,"-Infinity":-1/0}),bt(Math.atan),bt(Math.atanh,{1:1/0,"-1":-1/0}),bt(Math.cos),bt(Math.cosh,{"-Infinity":1/0,Infinity:1/0});const gt=Math.PI/180,wt=(bt((e=>e*gt),{Infinity:1/0,"-Infinity":1/0}),180/Math.PI);bt((e=>e*wt),{Infinity:1/0,"-Infinity":-1/0}),bt(Math.sin),bt(Math.sinh,{"-Infinity":-1/0,Infinity:1/0}),bt(Math.tan),Number.MAX_SAFE_INTEGER,Number.MIN_SAFE_INTEGER;const xt=(e,t,n)=>{W(Y(t),"Invalid expression: $and expects value to be an Array.");const r=t.map((e=>new Xe(e,n)));return e=>r.every((t=>t.test(e)))},St=(e,t,n)=>{W(Y(t),"Invalid expression. $or expects value to be an Array");const r=t.map((e=>new Xe(e,n)));return e=>r.some((t=>t.test(e)))},Ot=(e,t,n)=>{W(Y(t),"Invalid expression. $nor expects value to be an array.");const r=St(0,t,n);return e=>!r(e)},It=(e,t,n)=>{const r={};r[e]=je(t);const o=new Xe(r,n);return e=>!o.test(e)},Et=Ze(tt),kt=Ze(at),jt=Ze(ct),Pt=Ze(rt),_t=Ze(it),Nt=Ze(st),$t=Ze(nt),Dt=Ze(ot),At=Ze((function(e,t,n){return oe(e).some((e=>2===t.length&&e%t[0]===t[1]))})),Mt=Ze((function(e,t,n){const r=oe(e),o=e=>J(e)&&((e,t=!0)=>!!e||t&&""===e)(t.exec(e),n?.useStrictMode);return r.some(o)||le(r,1).some(o)}));Ze((function(e,t,n){if(!(Y(e)&&Y(t)&&e.length&&t.length))return!1;let r=!0;for(const o of t){if(!r)break;r=Q(o)&&Object.keys(o).includes("$elemMatch")?lt(e,o.$elemMatch,n):ee(o)?e.some((e=>"string"==typeof e&&o.test(e))):e.some((e=>he(o,e)))}return r}));const Tt=Ze(lt),Ct=Ze((function(e,t,n){return Array.isArray(e)&&e.length===t})),Rt=Ze((function(e,t,n){return(!1===t||0===t)&&void 0===e||(!0===t||1===t)&&void 0!==e})),Bt=Ze((function(e,t,n){return Y(t)?t.findIndex((t=>ht(e,t)))>=0:ht(e,t)}));var Kt=!1;function Lt(e,t){var n=x(e.primaryKey);t=I(t);var r,o=E(t);if("number"!=typeof o.skip&&(o.skip=0),o.selector?(o.selector=o.selector,Object.entries(o.selector).forEach((([e,t])=>{"object"==typeof t&&null!==t||(o.selector[e]={$eq:t})}))):o.selector={},o.index){var i=(r=o.index,Array.isArray(r)?r.slice(0):[r]);i.includes(n)||i.push(n),o.index=i}if(o.sort){var s=o.sort.find((e=>{return t=e,Object.keys(t)[0]===n;var t}));s||(o.sort=o.sort.slice(0),o.sort.push({[n]:"asc"}))}else if(o.index)o.sort=o.index.map((e=>({[e]:"asc"})));else{if(e.indexes){var a=new Set;Object.entries(o.selector).forEach((([e,t])=>{("object"!=typeof t||null===t||Object.keys(t).find((e=>D.has(e))))&&a.add(e)}));var c,u=-1;e.indexes.forEach((e=>{var t=j(e)?e:[e],n=t.findIndex((e=>!a.has(e)));n>0&&n>u&&(u=n,c=t)})),c&&(o.sort=c.map((e=>({[e]:"asc"}))))}if(!o.sort)if(e.indexes&&e.indexes.length>0){var l=e.indexes[0],f=j(l)?l:[l];o.sort=f.map((e=>({[e]:"asc"})))}else o.sort=[{[n]:"asc"}]}return o}function qt(e,t){if(!t.sort)throw d("SNH",{query:t});var n,r=(n=t.selector,Kt||(Ae(Ne.PIPELINE,{$sort:He,$project:Fe}),Ae(Ne.QUERY,{$and:xt,$eq:Et,$elemMatch:Tt,$exists:Rt,$gt:kt,$gte:jt,$in:Pt,$lt:_t,$lte:Nt,$ne:$t,$nin:Dt,$mod:At,$nor:Ot,$not:It,$or:St,$regex:Mt,$size:Ct,$type:Bt}),Kt=!0),new Xe(n));return e=>r.test(e)}function zt(e,t,n,r,o,i,s){for(var a,c=!!e.schema.attachments,u=[],l=[],f=[],h={id:function(e=10){for(var t="",n=0;n<e;n++)t+=p.charAt(Math.floor(26*Math.random()));return t}(10),events:[],checkpoint:null,context:o},m=h.events,v=[],y=[],b=[],g=n.size>0,w=r.length,x=function(){var e,o=r[O],h=o.document,p=o.previous,w=h[t],x=h._deleted,I=p&&p._deleted,E=void 0;if(g&&(E=n.get(w)),E){var k=E._rev;if(!p||p&&k!==p._rev){var j={isError:!0,status:409,documentId:w,writeRow:o,documentInDb:E};return f.push(j),1}var P=c?Ut(o):o;c&&(x?p&&Object.keys(p._attachments).forEach((e=>{y.push({documentId:w,attachmentId:e,digest:S(p)._attachments[e].digest})})):(Object.entries(h._attachments).find((([t,n])=>((p?p._attachments[t]:void 0)||n.data||(e={documentId:w,documentInDb:E,isError:!0,status:510,writeRow:o,attachmentId:t}),!0))),e||Object.entries(h._attachments).forEach((([e,t])=>{var n=p?p._attachments[e]:void 0;if(n){var r=P.document._attachments[e].digest;t.data&&n.digest!==r&&b.push({documentId:w,attachmentId:e,attachmentData:t,digest:t.digest})}else v.push({documentId:w,attachmentId:e,attachmentData:t,digest:t.digest})})))),e?f.push(e):(c?(l.push(Ut(P)),s&&s(h)):(l.push(P),s&&s(h)),a=P);var _=null,N=null,$=null;if(I&&!x)$="INSERT",_=c?Ft(h):h;else if(!p||I||x){if(!x)throw d("SNH",{args:{writeRow:o}});$="DELETE",_=S(h),N=p}else $="UPDATE",_=c?Ft(h):h,N=p;var D={documentId:w,documentData:_,previousDocumentData:N,operation:$};m.push(D)}else{var A=!!x;if(c&&Object.entries(h._attachments).forEach((([t,n])=>{n.data?v.push({documentId:w,attachmentId:t,attachmentData:n,digest:n.digest}):(e={documentId:w,isError:!0,status:510,writeRow:o,attachmentId:t},f.push(e))})),e||(c?(u.push(Ut(o)),i&&i(h)):(u.push(o),i&&i(h)),a=o),!A){var M={documentId:w,operation:"INSERT",documentData:c?Ft(h):h,previousDocumentData:c&&p?Ft(p):p};m.push(M)}}},O=0;O<w;O++)x();return{bulkInsertDocs:u,bulkUpdateDocs:l,newestRow:a,errors:f,eventBulk:h,attachmentsAdd:v,attachmentsRemove:y,attachmentsUpdate:b}}function Ut(e){return{previous:e.previous,document:Ft(e.document)}}function Ft(e){if(!e._attachments||0===Object.keys(e._attachments).length)return e;var t=I(e);return t._attachments={},Object.entries(e._attachments).forEach((([e,n])=>{var r,o,i;t._attachments[e]=(i=(r=n).data)?{length:(o=i,atob(o).length),digest:r.digest,type:r.type}:r})),t}async function Wt(e,t,n){if(e.getChangedDocumentsSince)return e.getChangedDocumentsSince(t,n);var r=x(e.schema.primaryKey),o=function(e,t){if(!t.sort)throw d("SNH",{query:t});return{query:t,queryPlan:$(e,t)}}(e.schema,function(e,t,n){var r=x(e.schema.primaryKey),o=n?n.lwt:1,i=n?n.id:"";return Lt(e.schema,{selector:{$or:[{"_meta.lwt":{$gt:o}},{"_meta.lwt":{$eq:o},[r]:{$gt:n?i:""}}],"_meta.lwt":{$gte:o}},sort:[{"_meta.lwt":"asc"},{[r]:"asc"}],skip:0,limit:t})}(e,t,n)),i=(await e.query(o)).documents,s=k(i);return{documents:i,checkpoint:s?{id:s[r],lwt:s._meta.lwt}:n||{id:"",lwt:0}}}new WeakMap,new WeakMap;var Vt="16.8.1",Ht="16.8.1";function Jt(e,t){var n=e.get(t);if(void 0===n)throw new Error("missing value from map "+t);return n}function Gt(e,t,n,r){var o=e.get(t);return void 0===o?(o=n(),e.set(t,o)):r&&r(o),o}function Yt(e=0){return new Promise((t=>setTimeout(t,e)))}Promise.resolve(!0);var Qt=Promise.resolve(!1),Xt=(Promise.resolve(null),Promise.resolve());function Zt(e=1e4){return"function"==typeof requestIdleCallback?new Promise((t=>{requestIdleCallback((()=>t()),{timeout:e})})):Yt(0)}function en(e,t){var n=t.map((t=>{var n=w(e,t);if(!n)throw new Error("not in schema: "+t);var r,o=n.type;"number"!==o&&"integer"!==o||(r=tn(n));var i,s=O(t),a=n.maxLength?n.maxLength:0;return i="string"===o?e=>{var t=s(e);return t||(t=""),t.padEnd(a," ")}:"boolean"===o?e=>s(e)?"1":"0":e=>{var t=s(e);return nn(r,t)},{fieldName:t,schemaPart:n,parsedLengths:r,getValue:s,getIndexStringPart:i}}));return n}function tn(e){var t=Math.floor(e.minimum),n=Math.ceil(e.maximum),r=e.multipleOf,o=(n-t).toString().length,i=r.toString().split("."),s=0;return i.length>1&&(s=i[1].length),{minimum:t,maximum:n,nonDecimals:o,decimals:s,roundedMinimum:t}}function nn(e,t){void 0===t&&(t=0),t<e.minimum&&(t=e.minimum),t>e.maximum&&(t=e.maximum);var n=(Math.floor(t)-e.roundedMinimum).toString().padStart(e.nonDecimals,"0");if(e.decimals>0){var r=t.toString().split(".");n+=(r.length>1?r[1]:"0").padEnd(e.decimals,"0")}return n}function rn(e,t,n){var r="";return t.forEach(((t,o)=>{var i=w(e,t),s=n[o],a=i.type;switch(a){case"string":var c=S(i.maxLength,"maxLength not set");r+="string"==typeof s?s.padEnd(c," "):"".padEnd(c," ");break;case"boolean":r+=null===s||s===N?"0":s===_||s?"1":"0";break;case"number":case"integer":var u=tn(i);if(null===s||s===N)r+="0".repeat(u.nonDecimals+u.decimals);else if(s===_)r+=nn(u,u.maximum);else{var l=nn(u,s);r+=l}break;default:throw new Error("unknown index type "+a)}})),r}function on(e,t,n){var r="";return t.forEach(((t,o)=>{var i=w(e,t),s=n[o],a=i.type;switch(a){case"string":var c=S(i.maxLength,"maxLength not set");r+="string"==typeof s&&s!==_?s.padEnd(c," "):"".padEnd(c,s===N?" ":_);break;case"boolean":r+=null===s||s?"1":"0";break;case"number":case"integer":var u=tn(i);r+=null===s||s===_?"9".repeat(u.nonDecimals+u.decimals):s===N?"0".repeat(u.nonDecimals+u.decimals):nn(u,s);break;default:throw new Error("unknown index type "+a)}})),r}function sn(e){return e.join("||")}var an=["_deleted","_meta.lwt"];function cn(e,t){var n=sn(t);return Jt(e.indexIdByName,n)}sn(an);var un={locale:null,unique:!1};function ln(e,t,n,r){for(var o={i:n,d:r,i0:void 0,i1:void 0,i2:void 0,i3:void 0,i4:void 0,i5:void 0,i6:void 0,i7:void 0},i=0;i<e;++i){var s=(0,t[i])(r);o["i"+i]=s}return o}function fn(e){var t={},n=e.indexes?e.indexes.map((e=>Array.isArray(e)?e.slice(0):[e])):[];n.push(an);var r=new Map;return n.forEach(((n,o)=>{var i="i"+o,s=sn(n);if(r.has(s))throw new Error("duplicate index "+s);r.set(s,i),t[i]=function(e,t){var n=en(e,t),r=n.length,o=n.map((e=>e.getIndexStringPart));return function(e){for(var t="",n=0;n<r;++n)t+=o[n](e);return t}}(e,n)})),{indexIdByName:r,monadByIndexId:t}}var dn={durability:"relaxed"},hn="indexeddb",pn=0;function mn(e,t){return e+"||"+t}var vn=new Map;function yn(e,t){var n=Gt(vn,e,(()=>Xt));return n=S(n).then((()=>t())),vn.set(e,n),n}function bn(e,t){t.onversionchange=n=>{e.closed||(t.close(),e.creationPromise=e.refreshIDBDatabase())}}async function gn(e,t,n,r){var o=await Gt(e.indexedDBStates,n.databaseName,(()=>async function(e,t,n){var r=pn++,o=await function(e,t){return"function"==typeof t?t(e):t}(e,n.indexedDB),i=async()=>(await Yt(0),yn(e.databaseName,(()=>new Promise(((t,n)=>{var i=o.open(e.databaseName);i.onerror=function(t){console.error(r+": OPEN IDB DATABASE "+e.databaseName+" ERROR"),n(t)},i.onsuccess=function(e){var n=i.result;t(n),bn(s,n)},Sn(s,i)}))))),s={indexedDB:o,debugId:r,closed:!1,storage:t,settings:n,refreshIDBDatabase:i,creationPromise:i(),name:e.databaseName,refCount:0,storesToOpen:[]};return s}(n,e,t)));return o.storesToOpen=o.storesToOpen.concat(r),o.refCount=o.refCount+1,o.creationPromise.then((()=>wn(S(o)))).then((()=>S(o)))}async function wn(e){if(0!==e.storesToOpen.length)return e.creationPromise=e.creationPromise.then((async t=>{var n=new Set(Array.from(t.objectStoreNames));if(0===e.storesToOpen.filter((e=>!n.has(xn(e.collectionName,e.schema).documentStore))).length)return t;var r=t.version+1;return t.close(),yn(e.name,(()=>new Promise(((t,n)=>{var o=e.indexedDB.open(e.name,r);o.onerror=function(t){console.error(e.debugId+": ERROR openStoresOnExistingDatabase() openRequest: error "),n(t)},o.onsuccess=function(n){var r=o.result;bn(e,r),t(r)},o.onblocked=e=>{},Sn(e,o)}))))})),e.creationPromise}function xn(e,t){var n=t.version;return{documentStore:e+"-"+n+"-documents",writeAheadStore:e+"-"+n+"-wal",attachmentsStore:e+"-"+n+"-attachments"}}function Sn(e,t){t.onupgradeneeded=function(n){var r=t.result;e.storesToOpen.forEach((e=>{var t=r.objectStoreNames,n=xn(e.collectionName,e.schema);if(!t.contains(n.documentStore)){var o=r.createObjectStore(n.documentStore,{keyPath:"i",autoIncrement:!1});r.createObjectStore(n.writeAheadStore,{keyPath:"i",autoIncrement:!1}),function(e,t){t.indexIds.forEach((t=>{e.createIndex(t,t,un)}))}(o,e),e.schema.attachments&&r.createObjectStore(n.attachmentsStore,{keyPath:"docIdWithAttachmentId",autoIncrement:!1})}})),e.storesToOpen=[]}}function On(e){if(e.closed)throw new Error("RxStorageInstanceIndexedDB is closed "+e.databaseName+"-"+e.collectionName)}async function In(e,t){var n=e.primaryPath,r=e.internals.indexIds.length,o=e.internals.getIndexableStringByIndexNumber,i=t.objectStore(e.internals.storeNames.writeAheadStore),s=await new Promise(((e,t)=>{var n=i.get("documents");n.onerror=t,n.onsuccess=t=>{var r=n.result;e(r?JSON.parse(r.docsData):void 0)}}));if(s&&s.length>0){for(var a,c=t.objectStore(e.internals.storeNames.documentStore),u=0;u<s.length;++u){var l=s[u],f=ln(r,o,l[n],l);a=c.put(f)}await new Promise(((e,t)=>{a.onerror=t,a.onsuccess=()=>e(!0)})),i.delete("documents")}return t}async function En(e){var t,n=[e.internals.storeNames.documentStore,e.internals.storeNames.writeAheadStore];e.schema.attachments&&n.push(e.internals.storeNames.attachmentsStore);for(var r=100;r>0;){var o=await e.internals.state.creationPromise;r-=1;try{t=o.transaction(n,"readwrite",dn);break}catch(t){if("InvalidStateError"!==t.name&&"NotFoundError"!==t.name||!(r>0))throw t;"NotFoundError"===t.name?await wn(e.internals.state):e.internals.state.creationPromise=e.internals.state.refreshIDBDatabase()}}return await In(e,S(t)),S(t)}var kn=function(){function e(e){this.allTasksRuns=[],this.instance=e,this.txPromise=En(this.instance).then((t=>In(e,t)))}return e.prototype.addTask=function(e){var t=this.txPromise.then((t=>e(t))),n=t.catch((()=>null));this.allTasksRuns.push(n);var r=this.allTasksRuns.length;return n.then((()=>Promise.all(this.allTasksRuns))).then((()=>{this.allTasksRuns.length===r&&(this.instance.openReadonlyTransaction=void 0)})),t.catch((t=>{if("TransactionInactiveError"===t.name)return this.instance.openReadonlyTransaction=void 0,jn(this.instance,e);throw t}))},e}();function jn(e,t){return e.openReadonlyTransaction||(e.openReadonlyTransaction=new kn(e)),e.openReadonlyTransaction.addTask(t)}var Pn=0;function _n(){var e=Date.now();(e+=.01)<=Pn&&(e=Pn+.01);var t=parseFloat(e.toFixed(2));return Pn=t,t}var Nn=function(e,t){return Nn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},Nn(e,t)};function $n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}Nn(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function Dn(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))}function An(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}function Mn(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Tn(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s}function Cn(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))}function Rn(e){return this instanceof Rn?(this.v=e,this):new Rn(e)}function Bn(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,o=n.apply(e,t||[]),i=[];return r=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),s("next"),s("throw"),s("return",(function(e){return function(t){return Promise.resolve(t).then(e,u)}})),r[Symbol.asyncIterator]=function(){return this},r;function s(e,t){o[e]&&(r[e]=function(t){return new Promise((function(n,r){i.push([e,t,n,r])>1||a(e,t)}))},t&&(r[e]=t(r[e])))}function a(e,t){try{(n=o[e](t)).value instanceof Rn?Promise.resolve(n.value.v).then(c,u):l(i[0][2],n)}catch(e){l(i[0][3],e)}var n}function c(e){a("next",e)}function u(e){a("throw",e)}function l(e,t){e(t),i.shift(),i.length&&a(i[0][0],i[0][1])}}function Kn(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=Mn(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,o){!function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)}(r,o,(t=e[n](t)).done,t.value)}))}}}function Ln(e){return"function"==typeof e}function qn(e){var t=e((function(e){Error.call(e),e.stack=(new Error).stack}));return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;var zn=qn((function(e){return function(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}}));function Un(e,t){if(e){var n=e.indexOf(t);0<=n&&e.splice(n,1)}}var Fn=function(){function e(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}var t;return e.prototype.unsubscribe=function(){var e,t,n,r,o;if(!this.closed){this.closed=!0;var i=this._parentage;if(i)if(this._parentage=null,Array.isArray(i))try{for(var s=Mn(i),a=s.next();!a.done;a=s.next())a.value.remove(this)}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}else i.remove(this);var c=this.initialTeardown;if(Ln(c))try{c()}catch(e){o=e instanceof zn?e.errors:[e]}var u=this._finalizers;if(u){this._finalizers=null;try{for(var l=Mn(u),f=l.next();!f.done;f=l.next()){var d=f.value;try{Hn(d)}catch(e){o=null!=o?o:[],e instanceof zn?o=Cn(Cn([],Tn(o)),Tn(e.errors)):o.push(e)}}}catch(e){n={error:e}}finally{try{f&&!f.done&&(r=l.return)&&r.call(l)}finally{if(n)throw n.error}}}if(o)throw new zn(o)}},e.prototype.add=function(t){var n;if(t&&t!==this)if(this.closed)Hn(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(t)}},e.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},e.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},e.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&Un(t,e)},e.prototype.remove=function(t){var n=this._finalizers;n&&Un(n,t),t instanceof e&&t._removeParent(this)},e.EMPTY=((t=new e).closed=!0,t),e}(),Wn=Fn.EMPTY;function Vn(e){return e instanceof Fn||e&&"closed"in e&&Ln(e.remove)&&Ln(e.add)&&Ln(e.unsubscribe)}function Hn(e){Ln(e)?e():e.unsubscribe()}var Jn={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Gn={setTimeout:function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var o=Gn.delegate;return(null==o?void 0:o.setTimeout)?o.setTimeout.apply(o,Cn([e,t],Tn(n))):setTimeout.apply(void 0,Cn([e,t],Tn(n)))},clearTimeout:function(e){var t=Gn.delegate;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function Yn(e){Gn.setTimeout((function(){var t=Jn.onUnhandledError;if(!t)throw e;t(e)}))}function Qn(){}var Xn=Zn("C",void 0,void 0);function Zn(e,t,n){return{kind:e,value:t,error:n}}var er=null;function tr(e){if(Jn.useDeprecatedSynchronousErrorHandling){var t=!er;if(t&&(er={errorThrown:!1,error:null}),e(),t){var n=er,r=n.errorThrown,o=n.error;if(er=null,r)throw o}}else e()}var nr=function(e){function t(t){var n=e.call(this)||this;return n.isStopped=!1,t?(n.destination=t,Vn(t)&&t.add(n)):n.destination=ur,n}return $n(t,e),t.create=function(e,t,n){return new sr(e,t,n)},t.prototype.next=function(e){this.isStopped?cr(function(e){return Zn("N",e,void 0)}(e),this):this._next(e)},t.prototype.error=function(e){this.isStopped?cr(Zn("E",void 0,e),this):(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped?cr(Xn,this):(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(Fn),rr=Function.prototype.bind;function or(e,t){return rr.call(e,t)}var ir=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(e){ar(e)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(e){ar(e)}else ar(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(e){ar(e)}},e}(),sr=function(e){function t(t,n,r){var o,i,s=e.call(this)||this;return Ln(t)||!t?o={next:null!=t?t:void 0,error:null!=n?n:void 0,complete:null!=r?r:void 0}:s&&Jn.useDeprecatedNextContext?((i=Object.create(t)).unsubscribe=function(){return s.unsubscribe()},o={next:t.next&&or(t.next,i),error:t.error&&or(t.error,i),complete:t.complete&&or(t.complete,i)}):o=t,s.destination=new ir(o),s}return $n(t,e),t}(nr);function ar(e){var t;Jn.useDeprecatedSynchronousErrorHandling?(t=e,Jn.useDeprecatedSynchronousErrorHandling&&er&&(er.errorThrown=!0,er.error=t)):Yn(e)}function cr(e,t){var n=Jn.onStoppedNotification;n&&Gn.setTimeout((function(){return n(e,t)}))}var ur={closed:!0,next:Qn,error:function(e){throw e},complete:Qn},lr="function"==typeof Symbol&&Symbol.observable||"@@observable";function fr(e){return e}function dr(e){return 0===e.length?fr:1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)}}var hr=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var r,o=this,i=(r=e)&&r instanceof nr||function(e){return e&&Ln(e.next)&&Ln(e.error)&&Ln(e.complete)}(r)&&Vn(r)?e:new sr(e,t,n);return tr((function(){var e=o,t=e.operator,n=e.source;i.add(t?t.call(i,n):n?o._subscribe(i):o._trySubscribe(i))})),i},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=pr(t))((function(t,r){var o=new sr({next:function(t){try{e(t)}catch(e){r(e),o.unsubscribe()}},error:r,complete:t});n.subscribe(o)}))},e.prototype._subscribe=function(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)},e.prototype[lr]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return dr(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=pr(e))((function(e,n){var r;t.subscribe((function(e){return r=e}),(function(e){return n(e)}),(function(){return e(r)}))}))},e.create=function(t){return new e(t)},e}();function pr(e){var t;return null!==(t=null!=e?e:Jn.Promise)&&void 0!==t?t:Promise}var mr=qn((function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}})),vr=function(e){function t(){var t=e.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return $n(t,e),t.prototype.lift=function(e){var t=new yr(this,this);return t.operator=e,t},t.prototype._throwIfClosed=function(){if(this.closed)throw new mr},t.prototype.next=function(e){var t=this;tr((function(){var n,r;if(t._throwIfClosed(),!t.isStopped){t.currentObservers||(t.currentObservers=Array.from(t.observers));try{for(var o=Mn(t.currentObservers),i=o.next();!i.done;i=o.next())i.value.next(e)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}}}))},t.prototype.error=function(e){var t=this;tr((function(){if(t._throwIfClosed(),!t.isStopped){t.hasError=t.isStopped=!0,t.thrownError=e;for(var n=t.observers;n.length;)n.shift().error(e)}}))},t.prototype.complete=function(){var e=this;tr((function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var t=e.observers;t.length;)t.shift().complete()}}))},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(t){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var t=this,n=this,r=n.hasError,o=n.isStopped,i=n.observers;return r||o?Wn:(this.currentObservers=null,i.push(e),new Fn((function(){t.currentObservers=null,Un(i,e)})))},t.prototype._checkFinalizedStatuses=function(e){var t=this,n=t.hasError,r=t.thrownError,o=t.isStopped;n?e.error(r):o&&e.complete()},t.prototype.asObservable=function(){var e=new hr;return e.source=this,e},t.create=function(e,t){return new yr(e,t)},t}(hr),yr=function(e){function t(t,n){var r=e.call(this)||this;return r.destination=t,r.source=n,r}return $n(t,e),t.prototype.next=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===n||n.call(t,e)},t.prototype.error=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===n||n.call(t,e)},t.prototype.complete=function(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)},t.prototype._subscribe=function(e){var t,n;return null!==(n=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==n?n:Wn},t}(vr);function br(e){return function(t){if(function(e){return Ln(null==e?void 0:e.lift)}(t))return t.lift((function(t){try{return e(t,this)}catch(e){this.error(e)}}));throw new TypeError("Unable to lift unknown Observable type")}}var gr=Array.isArray;function wr(e,t,n,r,o){return new xr(e,t,n,r,o)}var xr=function(e){function t(t,n,r,o,i,s){var a=e.call(this,t)||this;return a.onFinalize=i,a.shouldUnsubscribe=s,a._next=n?function(e){try{n(e)}catch(e){t.error(e)}}:e.prototype._next,a._error=o?function(e){try{o(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,a._complete=r?function(){try{r()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,a}return $n(t,e),t.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;e.prototype.unsubscribe.call(this),!n&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}},t}(nr),Sr=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function Or(e){return Ln(null==e?void 0:e.then)}function Ir(e){return Ln(e[lr])}function Er(e){return Symbol.asyncIterator&&Ln(null==e?void 0:e[Symbol.asyncIterator])}function kr(e){return new TypeError("You provided "+(null!==e&&"object"==typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}var jr="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function Pr(e){return Ln(null==e?void 0:e[jr])}function _r(e){return Bn(this,arguments,(function(){var t,n,r;return An(this,(function(o){switch(o.label){case 0:t=e.getReader(),o.label=1;case 1:o.trys.push([1,,9,10]),o.label=2;case 2:return[4,Rn(t.read())];case 3:return n=o.sent(),r=n.value,n.done?[4,Rn(void 0)]:[3,5];case 4:return[2,o.sent()];case 5:return[4,Rn(r)];case 6:return[4,o.sent()];case 7:return o.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}}))}))}function Nr(e){return Ln(null==e?void 0:e.getReader)}function $r(e){if(e instanceof hr)return e;if(null!=e){if(Ir(e))return o=e,new hr((function(e){var t=o[lr]();if(Ln(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")}));if(Sr(e))return r=e,new hr((function(e){for(var t=0;t<r.length&&!e.closed;t++)e.next(r[t]);e.complete()}));if(Or(e))return n=e,new hr((function(e){n.then((function(t){e.closed||(e.next(t),e.complete())}),(function(t){return e.error(t)})).then(null,Yn)}));if(Er(e))return Dr(e);if(Pr(e))return t=e,new hr((function(e){var n,r;try{for(var o=Mn(t),i=o.next();!i.done;i=o.next()){var s=i.value;if(e.next(s),e.closed)return}}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}e.complete()}));if(Nr(e))return Dr(_r(e))}var t,n,r,o;throw kr(e)}function Dr(e){return new hr((function(t){(function(e,t){var n,r,o,i;return Dn(this,void 0,void 0,(function(){var s,a;return An(this,(function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),n=Kn(e),c.label=1;case 1:return[4,n.next()];case 2:if((r=c.sent()).done)return[3,4];if(s=r.value,t.next(s),t.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=c.sent(),o={error:a},[3,11];case 6:return c.trys.push([6,,9,10]),r&&!r.done&&(i=n.return)?[4,i.call(n)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(o)throw o.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}}))}))})(e,t).catch((function(e){return t.error(e)}))}))}function Ar(e,t,n,r,o){void 0===r&&(r=0),void 0===o&&(o=!1);var i=t.schedule((function(){n(),o?e.add(this.schedule(null,r)):this.unsubscribe()}),r);if(e.add(i),!o)return i}function Mr(e,t,n){return void 0===n&&(n=1/0),Ln(t)?Mr((function(n,r){return function(e,t){return br((function(n,r){var o=0;n.subscribe(wr(r,(function(n){r.next(e.call(t,n,o++))})))}))}((function(e,o){return t(n,e,r,o)}))($r(e(n,r)))}),n):("number"==typeof t&&(n=t),br((function(t,r){return function(e,t,n,r,o,i,s,a){var c=[],u=0,l=0,f=!1,d=function(){!f||c.length||u||t.complete()},h=function(e){return u<r?p(e):c.push(e)},p=function(e){i&&t.next(e),u++;var a=!1;$r(n(e,l++)).subscribe(wr(t,(function(e){null==o||o(e),i?h(e):t.next(e)}),(function(){a=!0}),void 0,(function(){if(a)try{u--;for(var e=function(){var e=c.shift();s?Ar(t,s,(function(){return p(e)})):p(e)};c.length&&u<r;)e();d()}catch(e){t.error(e)}})))};return e.subscribe(wr(t,h,(function(){f=!0,d()}))),function(){null==a||a()}}(t,r,e,n)})))}function Tr(e){return e[e.length-1]}function Cr(e){return(t=Tr(e))&&Ln(t.schedule)?e.pop():void 0;var t}function Rr(e,t){return void 0===t&&(t=0),br((function(n,r){n.subscribe(wr(r,(function(n){return Ar(r,e,(function(){return r.next(n)}),t)}),(function(){return Ar(r,e,(function(){return r.complete()}),t)}),(function(n){return Ar(r,e,(function(){return r.error(n)}),t)})))}))}function Br(e,t){return void 0===t&&(t=0),br((function(n,r){r.add(e.schedule((function(){return n.subscribe(r)}),t))}))}function Kr(e,t){if(!e)throw new Error("Iterable cannot be null");return new hr((function(n){Ar(n,t,(function(){var r=e[Symbol.asyncIterator]();Ar(n,t,(function(){r.next().then((function(e){e.done?n.complete():n.next(e.value)}))}),0,!0)}))}))}function Lr(e,t){if(null!=e){if(Ir(e))return function(e,t){return $r(e).pipe(Br(t),Rr(t))}(e,t);if(Sr(e))return function(e,t){return new hr((function(n){var r=0;return t.schedule((function(){r===e.length?n.complete():(n.next(e[r++]),n.closed||this.schedule())}))}))}(e,t);if(Or(e))return function(e,t){return $r(e).pipe(Br(t),Rr(t))}(e,t);if(Er(e))return Kr(e,t);if(Pr(e))return function(e,t){return new hr((function(n){var r;return Ar(n,t,(function(){r=e[jr](),Ar(n,t,(function(){var e,t,o;try{t=(e=r.next()).value,o=e.done}catch(e){return void n.error(e)}o?n.complete():n.next(t)}),0,!0)})),function(){return Ln(null==r?void 0:r.return)&&r.return()}}))}(e,t);if(Nr(e))return function(e,t){return Kr(_r(e),t)}(e,t)}throw kr(e)}function qr(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=Cr(e),r=function(e,t){return"number"==typeof Tr(e)?e.pop():t}(e,1/0);return e=function(e){return 1===e.length&&gr(e[0])?e[0]:e}(e),br((function(t,o){(function(e){return void 0===e&&(e=1/0),Mr(fr,e)})(r)(function(e,t){return t?Lr(e,t):$r(e)}(Cn([t],Tn(e)),n)).subscribe(o)}))}Promise.resolve(!1),Promise.resolve(!0);var zr=Promise.resolve();function Ur(e,t){return e||(e=0),new Promise((function(n){return setTimeout((function(){return n(t)}),e)}))}function Fr(){return Math.random().toString(36).substring(2)}var Wr=0;function Vr(){var e=1e3*Date.now();return e<=Wr&&(e=Wr+1),Wr=e,e}var Hr={create:function(e){var t={time:Vr(),messagesCallback:null,bc:new BroadcastChannel(e),subFns:[]};return t.bc.onmessage=function(e){t.messagesCallback&&t.messagesCallback(e.data)},t},close:function(e){e.bc.close(),e.subFns=[]},onMessage:function(e,t){e.messagesCallback=t},postMessage:function(e,t){try{return e.bc.postMessage(t,!1),zr}catch(e){return Promise.reject(e)}},canBeUsed:function(){if("undefined"!=typeof globalThis&&globalThis.Deno&&globalThis.Deno.args)return!0;if("undefined"==typeof window&&"undefined"==typeof self||"function"!=typeof BroadcastChannel)return!1;if(BroadcastChannel._pubkey)throw new Error("BroadcastChannel: Do not overwrite window.BroadcastChannel with this module, this is not a polyfill");return!0},type:"native",averageResponseTime:function(){return 150},microSeconds:Vr};class Jr{ttl;map=new Map;_to=!1;constructor(e){this.ttl=e}has(e){return this.map.has(e)}add(e){this.map.set(e,Gr()),this._to||(this._to=!0,setTimeout((()=>{this._to=!1,function(e){const t=Gr()-e.ttl,n=e.map[Symbol.iterator]();for(;;){const r=n.next().value;if(!r)return;const o=r[0];if(!(r[1]<t))return;e.map.delete(o)}}(this)}),0))}clear(){this.map.clear()}}function Gr(){return Date.now()}function Yr(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=JSON.parse(JSON.stringify(e));return void 0===t.webWorkerSupport&&(t.webWorkerSupport=!0),t.idb||(t.idb={}),t.idb.ttl||(t.idb.ttl=45e3),t.idb.fallbackInterval||(t.idb.fallbackInterval=150),e.idb&&"function"==typeof e.idb.onclose&&(t.idb.onclose=e.idb.onclose),t.localstorage||(t.localstorage={}),t.localstorage.removeTimeout||(t.localstorage.removeTimeout=6e4),e.methods&&(t.methods=e.methods),t.node||(t.node={}),t.node.ttl||(t.node.ttl=12e4),t.node.maxParallelWrites||(t.node.maxParallelWrites=2048),void 0===t.node.useFastPath&&(t.node.useFastPath=!0),t}var Qr="messages",Xr={durability:"relaxed"};function Zr(){if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof window){if(void 0!==window.mozIndexedDB)return window.mozIndexedDB;if(void 0!==window.webkitIndexedDB)return window.webkitIndexedDB;if(void 0!==window.msIndexedDB)return window.msIndexedDB}return!1}function eo(e){e.commit&&e.commit()}function to(e,t){var n=e.transaction(Qr,"readonly",Xr),r=n.objectStore(Qr),o=[],i=IDBKeyRange.bound(t+1,1/0);if(r.getAll){var s=r.getAll(i);return new Promise((function(e,t){s.onerror=function(e){return t(e)},s.onsuccess=function(t){e(t.target.result)}}))}return new Promise((function(e,s){var a=function(){try{return i=IDBKeyRange.bound(t+1,1/0),r.openCursor(i)}catch(e){return r.openCursor()}}();a.onerror=function(e){return s(e)},a.onsuccess=function(r){var i=r.target.result;i?i.value.id<t+1?i.continue(t+1):(o.push(i.value),i.continue()):(eo(n),e(o))}}))}function no(e){return(t=e.db,n=e.options.idb.ttl,r=Date.now()-n,o=t.transaction(Qr,"readonly",Xr),i=o.objectStore(Qr),s=[],new Promise((function(e){i.openCursor().onsuccess=function(t){var n=t.target.result;if(n){var i=n.value;i.time<r?(s.push(i),n.continue()):(eo(o),e(s))}else e(s)}}))).then((function(t){return function(e,t){if(e.closed)return Promise.resolve([]);var n=e.db.transaction(Qr,"readwrite",Xr).objectStore(Qr);return Promise.all(t.map((function(e){var t=n.delete(e);return new Promise((function(e){t.onsuccess=function(){return e()}}))})))}(e,t.map((function(e){return e.id})))}));var t,n,r,o,i,s}function ro(e){e.closed||oo(e).then((function(){return Ur(e.options.idb.fallbackInterval)})).then((function(){return ro(e)}))}function oo(e){return e.closed?zr:e.messagesCallback?to(e.db,e.lastCursorId).then((function(t){var n=t.filter((function(e){return!!e})).map((function(t){return t.id>e.lastCursorId&&(e.lastCursorId=t.id),t})).filter((function(t){return function(e,t){return!(e.uuid===t.uuid||t.eMIs.has(e.id)||e.data.time<t.messagesCallbackTime)}(t,e)})).sort((function(e,t){return e.time-t.time}));return n.forEach((function(t){e.messagesCallback&&(e.eMIs.add(t.id),e.messagesCallback(t.data))})),zr})):zr}var io={create:function(e,t){return t=Yr(t),function(e){var t="pubkey.broadcast-channel-0-"+e,n=Zr().open(t);return n.onupgradeneeded=function(e){e.target.result.createObjectStore(Qr,{keyPath:"id",autoIncrement:!0})},new Promise((function(e,t){n.onerror=function(e){return t(e)},n.onsuccess=function(){e(n.result)}}))}(e).then((function(n){var r={closed:!1,lastCursorId:0,channelName:e,options:t,uuid:Fr(),eMIs:new Jr(2*t.idb.ttl),writeBlockPromise:zr,messagesCallback:null,readQueuePromises:[],db:n};return n.onclose=function(){r.closed=!0,t.idb.onclose&&t.idb.onclose()},ro(r),r}))},close:function(e){e.closed=!0,e.db.close()},onMessage:function(e,t,n){e.messagesCallbackTime=n,e.messagesCallback=t,oo(e)},postMessage:function(e,t){return e.writeBlockPromise=e.writeBlockPromise.then((function(){return function(e,t,n){var r={uuid:t,time:Date.now(),data:n},o=e.transaction([Qr],"readwrite",Xr);return new Promise((function(e,t){o.oncomplete=function(){return e()},o.onerror=function(e){return t(e)},o.objectStore(Qr).add(r),eo(o)}))}(e.db,e.uuid,t)})).then((function(){var t,n;0===(t=0,n=10,Math.floor(Math.random()*(n-t+1)+t))&&no(e)})),e.writeBlockPromise},canBeUsed:function(){return!!Zr()},type:"idb",averageResponseTime:function(e){return 2*e.idb.fallbackInterval},microSeconds:Vr};function so(){var e;if("undefined"==typeof window)return null;try{e=window.localStorage,e=window["ie8-eventlistener/storage"]||window.localStorage}catch(e){}return e}function ao(e){return"pubkey.broadcastChannel-"+e}function co(){var e=so();if(!e)return!1;try{var t="__broadcastchannel_check";e.setItem(t,"works"),e.removeItem(t)}catch(e){return!1}return!0}var uo,lo={create:function(e,t){if(t=Yr(t),!co())throw new Error("BroadcastChannel: localstorage cannot be used");var n=Fr(),r=new Jr(t.localstorage.removeTimeout),o={channelName:e,uuid:n,eMIs:r};return o.listener=function(e,t){var n=ao(e),r=function(e){e.key===n&&t(JSON.parse(e.newValue))};return window.addEventListener("storage",r),r}(e,(function(e){o.messagesCallback&&e.uuid!==n&&e.token&&!r.has(e.token)&&(e.data.time&&e.data.time<o.messagesCallbackTime||(r.add(e.token),o.messagesCallback(e.data)))})),o},close:function(e){var t;t=e.listener,window.removeEventListener("storage",t)},onMessage:function(e,t,n){e.messagesCallbackTime=n,e.messagesCallback=t},postMessage:function(e,t){return new Promise((function(n){Ur().then((function(){var r=ao(e.channelName),o={token:Fr(),time:Date.now(),data:t,uuid:e.uuid},i=JSON.stringify(o);so().setItem(r,i);var s=document.createEvent("Event");s.initEvent("storage",!0,!0),s.key=r,s.newValue=i,window.dispatchEvent(s),n()}))}))},canBeUsed:co,type:"localstorage",averageResponseTime:function(){var e=navigator.userAgent.toLowerCase();return e.includes("safari")&&!e.includes("chrome")?240:120},microSeconds:Vr},fo=Vr,ho=new Set,po={create:function(e){var t={time:fo(),name:e,messagesCallback:null};return ho.add(t),t},close:function(e){ho.delete(e)},onMessage:function(e,t){e.messagesCallback=t},postMessage:function(e,t){return new Promise((function(n){return setTimeout((function(){Array.from(ho).forEach((function(n){n.name===e.name&&n!==e&&n.messagesCallback&&n.time<t.time&&n.messagesCallback(t)})),n()}),5)}))},canBeUsed:function(){return!0},type:"simulate",averageResponseTime:function(){return 5},microSeconds:fo},mo=[Hr,io,lo],vo=new Set,yo=0,bo=function(e,t){var n,r,o;this.id=yo++,vo.add(this),this.name=e,uo&&(t=uo),this.options=Yr(t),this.method=function(e){var t=[].concat(e.methods,mo).filter(Boolean);if(e.type){if("simulate"===e.type)return po;var n=t.find((function(t){return t.type===e.type}));if(n)return n;throw new Error("method-type "+e.type+" not found")}e.webWorkerSupport||(t=t.filter((function(e){return"idb"!==e.type})));var r=t.find((function(e){return e.canBeUsed()}));if(r)return r;throw new Error("No usable method found in "+JSON.stringify(mo.map((function(e){return e.type}))))}(this.options),this._iL=!1,this._onML=null,this._addEL={message:[],internal:[]},this._uMP=new Set,this._befC=[],this._prepP=null,(o=r=(n=this).method.create(n.name,n.options))&&"function"==typeof o.then?(n._prepP=r,r.then((function(e){n._state=e}))):n._state=r};function go(e,t,n){var r={time:e.method.microSeconds(),type:t,data:n};return(e._prepP?e._prepP:zr).then((function(){var t=e.method.postMessage(e._state,r);return e._uMP.add(t),t.catch().then((function(){return e._uMP.delete(t)})),t}))}function wo(e){return e._addEL.message.length>0||e._addEL.internal.length>0}function xo(e,t,n){e._addEL[t].push(n),function(e){if(!e._iL&&wo(e)){var t=function(t){e._addEL[t.type].forEach((function(e){t.time>=e.time&&e.fn(t.data)}))},n=e.method.microSeconds();e._prepP?e._prepP.then((function(){e._iL=!0,e.method.onMessage(e._state,t,n)})):(e._iL=!0,e.method.onMessage(e._state,t,n))}}(e)}function So(e,t,n){e._addEL[t]=e._addEL[t].filter((function(e){return e!==n})),function(e){if(e._iL&&!wo(e)){e._iL=!1;var t=e.method.microSeconds();e.method.onMessage(e._state,null,t)}}(e)}bo._pubkey=!0,bo.prototype={postMessage:function(e){if(this.closed)throw new Error("BroadcastChannel.postMessage(): Cannot post message after channel has closed "+JSON.stringify(e));return go(this,"message",e)},postInternal:function(e){return go(this,"internal",e)},set onmessage(e){var t={time:this.method.microSeconds(),fn:e};So(this,"message",this._onML),e&&"function"==typeof e?(this._onML=t,xo(this,"message",t)):this._onML=null},addEventListener:function(e,t){xo(this,e,{time:this.method.microSeconds(),fn:t})},removeEventListener:function(e,t){So(this,e,this._addEL[e].find((function(e){return e.fn===t})))},close:function(){var e=this;if(!this.closed){vo.delete(this),this.closed=!0;var t=this._prepP?this._prepP:zr;return this._onML=null,this._addEL.message=[],t.then((function(){return Promise.all(Array.from(e._uMP))})).then((function(){return Promise.all(e._befC.map((function(e){return e()})))})).then((function(){return e.method.close(e._state)}))}},get type(){return this.method.type},get isClosed(){return this.closed}};var Oo=new Map;function Io(e,t){var n=Oo.get(e);if(n)return n.refs.delete(t),0===n.refs.size?(Oo.delete(e),n.bc.close()):void 0}function Eo(e,t,n,r){if(t.multiInstance){var o=r||function(e,t,n,r){var o=Oo.get(t);return o||(o={bc:new bo(["RxDB:",e,n].join("|")),refs:new Set},Oo.set(t,o)),o.refs.add(r),o.bc}(e,t.databaseInstanceToken,n.databaseName,n),i=new vr,s=n=>{n.storageName===e&&n.databaseName===t.databaseName&&n.collectionName===t.collectionName&&n.version===t.schema.version&&i.next(n.eventBulk)};o.addEventListener("message",s);var a=n.changeStream(),c=!1,u=a.subscribe((n=>{c||o.postMessage({storageName:e,databaseName:t.databaseName,collectionName:t.collectionName,version:t.schema.version,eventBulk:n})}));n.changeStream=function(){return i.asObservable().pipe(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return qr.apply(void 0,Cn([],Tn(e)))}(a))};var l=n.close.bind(n);n.close=async function(){return c=!0,u.unsubscribe(),o.removeEventListener("message",s),r||await Io(t.databaseInstanceToken,n),l()};var f=n.remove.bind(n);n.remove=async function(){return c=!0,u.unsubscribe(),o.removeEventListener("message",s),r||await Io(t.databaseInstanceToken,n),f()}}}async function ko(e,t){return jn(e,(async n=>{var r=t.queryPlan,o=t.query,i=o.skip?o.skip:0,s=i+(o.limit?o.limit:1/0),a=e.internals.storeNames.documentStore,c=e.settings.batchSize?e.settings.batchSize:50,u=!1;r.selectorSatisfiedByIndex||(u=qt(e.schema,o));var l=r.index,f=!r.sortSatisfiedByIndex,h=l,p=r.startKeys,m=rn(e.schema,h,p),v=r.endKeys,y=on(e.schema,h,v),b=[],g=n.objectStore(a),w=cn(e.internals,h),x=g.index(w);u||t.query.limit||(c=1e5);var S=!1;if(await async function(e,t,n,r,o,i,s,a){var c=e.settings.IDBKeyRange?e.settings.IDBKeyRange:IDBKeyRange,u=e.internals.getIndexableStringByIndexId[s];if("function"==typeof n.getAll&&1!==r)for(var l,f=!0,d=!1,h=async function(){l&&(o=u(l.d));var e=c.bound(o,i,!f||!t.inclusiveStart,!t.inclusiveEnd);f=!1;var s=n.getAll(e,r);await new Promise(((e,t)=>{s.onerror=t,s.onsuccess=t=>{var n=t.target.result;l=k(n),0!==n.length&&!1===a(n)&&(d=!0),n.length<r&&(d=!0),e()}}))};!d;)await h();else{var p=c.bound(o,i,!t.inclusiveStart,!t.inclusiveEnd),m=n.openCursor(p);await new Promise((e=>{m.onsuccess=function(t){var n=t.target.result;if(n){var r=n.value;a([r])?n.continue():e()}else e()}}))}}(e,r,x,c,m,y,w,(e=>{for(var t=0;t<e.length;t++){var n=e[t].d;if(S||u&&!u(n)||b.push(n),!f&&b.length===s){S=!0;break}}return!S})),f){var I=function(e,t){if(!t.sort)throw d("SNH",{query:t});var n=[];return t.sort.forEach((e=>{var t=Object.keys(e)[0],r=Object.values(e)[0];n.push({key:t,direction:r,getValueFn:O(t)})})),(e,t)=>{for(var r=0;r<n.length;++r){var o=n[r],i=o.getValueFn(e),s=o.getValueFn(t);if(i!==s)return"asc"===o.direction?U(i,s):U(s,i)}}}(e.schema,o);b=b.sort(I)}return{documents:b=b.slice(i,s)}}))}async function jo(e,t,n){var r=e.primaryPath,o=e.internals,i=e.internals.state;await i.creationPromise;var s=[o.storeNames.documentStore,o.storeNames.writeAheadStore];e.schema.attachments&&s.push(o.storeNames.attachmentsStore),On(e);var a,c=await En(e),u=c.objectStore(o.storeNames.documentStore);a=0===e.internals.minKnownDocsAmount&&t.length>30&&!await function(e,t){var n=(e.settings.IDBKeyRange?e.settings.IDBKeyRange:IDBKeyRange).lowerBound(N,!0),r=t.getKey(n);return new Promise((e=>{r.onsuccess=()=>{e(!!r.result)}}))}(e,u)?new Map:await function(e,t,n){var r=n.length,o=new Map;if(0===r)return Promise.resolve(o);for(var i=new Array(r),s=0;s<r;s++){var a=n[s].document[e],c=t.get(a);i[s]=c}var u=S(k(i));return new Promise(((t,n)=>{u.onerror=n,u.onsuccess=()=>{for(var n=0;n<r;n++){var s=i[n].result;if(s){var a=s.d,c=a[e];o.set(c,a)}}t(o)}}))}(r,u,t);for(var l=zt(e,r,a,t,n),f=l.errors,d=l.bulkInsertDocs,h=new Array(d.length),p=0;p<d.length;++p){var m=d[p].document;h[p]=m}for(var v,y=l.bulkUpdateDocs,b=0;b<y.length;++b){var g=y[b].document;h.push(g)}if(h.length>0){var w=c.objectStore(o.storeNames.writeAheadStore).put({i:"documents",docsData:JSON.stringify(h)});await new Promise(((e,t)=>{w.onerror=t,w.onsuccess=e})),e.handleWalIdlePromise||Yt(100).then((()=>Zt())).then((async()=>{e.handleWalIdlePromise=void 0,e.closed||await jn(e,(()=>Qt))}))}if(e.schema.attachments){var x=c.objectStore(e.internals.storeNames.attachmentsStore);l.attachmentsAdd.forEach((e=>{v=x.put({docIdWithAttachmentId:mn(e.documentId,e.attachmentId),length:e.attachmentData.length,type:e.attachmentData.type,data:e.attachmentData.data})})),l.attachmentsUpdate.forEach((e=>{v=x.put({docIdWithAttachmentId:mn(e.documentId,e.attachmentId),length:e.attachmentData.length,type:e.attachmentData.type,data:e.attachmentData.data})})),l.attachmentsRemove.forEach((e=>{v=x.delete(mn(e.documentId,e.attachmentId))}))}if(v&&await new Promise(((e,t)=>{S(v).onerror=t,S(v).onsuccess=e})),c.commit&&c.commit(),l.eventBulk.events.length>0){var O=S(l.newestRow).document;l.eventBulk.checkpoint={id:O[r],lwt:O._meta.lwt},e.changes$.next(l.eventBulk)}return{error:f}}var Po=_n(),_o=function(){function e(e,t,n,r,o,i,s){this.changes$=new vr,this.instanceId=Po++,this.storage=e,this.databaseName=t,this.collectionName=n,this.schema=r,this.internals=o,this.options=i,this.settings=s,this.primaryPath=x(this.schema.primaryKey)}var t=e.prototype;return t.updateMinKnownDocs=function(e){this.internals.minKnownDocsAmount<e&&(this.internals.minKnownDocsAmount=e)},t.bulkWrite=async function(e,t){var n=await jo(this,e,t);return this.updateMinKnownDocs(e.length-n.error.length),n},t.findDocumentsById=async function(e,t){On(this);var n=await jn(this,(async n=>function(e,t,n){var r=t.length;if(0===r)return Promise.resolve([]);for(var o=new Array(r),i=0;i<r;i++){var s=t[i];o[i]=e.get(s)}var a=[],c=S(k(o));return new Promise(((e,t)=>{c.onerror=t,c.onsuccess=()=>{for(var t=0;t<r;t++){var i=o[t].result;if(i){var s=i.d;!n&&s._deleted||a.push(s)}}e(a)}}))}(n.objectStore(this.internals.storeNames.documentStore),e,t)));return this.updateMinKnownDocs(n.length),n},t.query=async function(e){await this.internals.state.creationPromise,On(this);var t=await ko(this,e);return this.updateMinKnownDocs(t.documents.length),t},t.count=async function(e){if(e.queryPlan.selectorSatisfiedByIndex){var t=await async function(e,t){return jn(e,(async n=>{var r,o=t.queryPlan,i=e.internals.storeNames.documentStore,s=o.index,a=s,c=o.startKeys,u=rn(e.schema,a,c),l=o.endKeys,f=on(e.schema,a,l),d=n.objectStore(i);r=1===s.length&&s[0]===e.primaryPath?cn(e.internals,["_deleted",e.primaryPath]):cn(e.internals,a);var h=d.index(r),p=(e.settings.IDBKeyRange?e.settings.IDBKeyRange:IDBKeyRange).bound(u,f,!o.inclusiveStart,!o.inclusiveEnd),m=h.count(p);return{count:await new Promise(((e,t)=>{m.onsuccess=function(){e(m.result)},m.onerror=t})),mode:"fast"}}))}(this,e);return this.updateMinKnownDocs(t.count),t}var n=await ko(this,e);return this.updateMinKnownDocs(n.documents.length),{count:n.documents.length,mode:"slow"}},t.changeStream=function(){return this.changes$.asObservable()},t.cleanup=async function(e){await Yt(0),await Yt(0);var t=this.internals.state;await t.creationPromise;var n=this.settings.IDBKeyRange;On(this);var r=(await En(this)).objectStore(this.internals.storeNames.documentStore),o=this.settings.batchSize,i=_n()-e,s=cn(this.internals,an),a=r.index(s),c=rn(this.schema,an,[!0,1]),u=on(this.schema,an,[!0,i]),l=n.bound(c,u,!0,!0),f=await new Promise(((e,t)=>{var n=a.getAll(l,o);n.onerror=t,n.onsuccess=function(t){e(t.target.result)}}));return await Promise.all(f.map((e=>new Promise(((t,n)=>{var o=e.i,i=r.delete(o);i.onerror=n,i.onsuccess=()=>t()}))))),f.length<o},t.remove=async function(){var e=this.internals.state;return await e.creationPromise,On(this),jn(this,(async e=>{var t=[e.objectStore(this.internals.storeNames.documentStore),e.objectStore(this.internals.storeNames.writeAheadStore)];return this.schema.attachments&&t.push(e.objectStore(this.internals.storeNames.attachmentsStore)),await Promise.all(t.map((e=>new Promise(((t,n)=>{var r=e.clear();r.onerror=n,r.onsuccess=t}))))),this.close()}))},t.getAttachmentData=async function(e,t){var n=this.internals.state;return await n.creationPromise,On(this),jn(this,(n=>{var r=n.objectStore(this.internals.storeNames.attachmentsStore),o=mn(e,t);return new Promise(((n,i)=>{var s=r.get(o);s.onsuccess=()=>{var r=s.result;r?n(r.data):i("attachment missing documentId: "+e+" attachmentId: "+t)}}))}))},t.close=async function(){return this.closed||(this.closed=(async()=>(await this.internals.state.creationPromise,await jn(this,(async e=>{})),this.changes$.complete(),async function(e){if(!e.closed&&(e.refCount=e.refCount-1,0===e.refCount))return e.closed=!0,e.storage.indexedDBStates.delete(e.name),e.creationPromise.then((e=>e.close()))}(this.internals.state)))()),this.closed},e}(),No=function(){function e(e){this.name=hn,this.rxdbVersion=Ht,this.indexedDBStates=new Map,this.settings=e}return e.prototype.createStorageInstance=function(e){return function(e){if(e.schema.keyCompression)throw d("UT5",{args:{params:e}});if((t=e.schema).encrypted&&t.encrypted.length>0||t.attachments&&t.attachments.encrypted)throw d("UT6",{args:{params:e}});var t;if(e.schema.attachments&&e.schema.attachments.compression)throw d("UT7",{args:{params:e}})}(e),async function(e,t,n){var r=fn(t.schema),o=Array.from(r.indexIdByName.values()),i=await gn(e,n,t,[{collectionName:t.collectionName,schema:t.schema,indexIds:o}]);await i.creationPromise;var s={state:i,storeNames:xn(t.collectionName,t.schema),getIndexableStringByIndexId:r.monadByIndexId,getIndexableStringByIndexNumber:Object.values(r.monadByIndexId),indexIdByName:r.indexIdByName,indexNames:Object.keys(r),indexIds:o,minKnownDocsAmount:0},a=new _o(e,t.databaseName,t.collectionName,t.schema,s,t.options,n);return await Eo(hn,t,a),a}(this,e,Object.assign({},this.settings,e.options))},e}();function $o(e,t){return br((function(n,r){var o=0;n.subscribe(wr(r,(function(n){return e.call(t,n,o++)&&r.next(n)})))}))}function Do(e,t){if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t){if(e.constructor!==t.constructor)return!1;var n,r;if(Array.isArray(e)){if((n=e.length)!==t.length)return!1;for(r=n;0!=r--;)if(!Do(e[r],t[r]))return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===t.toString();var o=Object.keys(e);if((n=o.length)!==Object.keys(t).length)return!1;for(r=n;0!=r--;)if(!Object.prototype.hasOwnProperty.call(t,o[r]))return!1;for(r=n;0!=r--;){var i=o[r];if(!Do(e[i],t[i]))return!1}return!0}return e!=e&&t!=t}function Ao(e,t){return{connectionId:e.connectionId,answerTo:e.requestId,method:e.method,error:(n=t,{name:n.name,message:n.message,rxdb:n.rxdb,parameters:n.parameters,extensions:n.extensions,code:n.code,url:n.url,stack:n.stack?n.stack.replace(/\n/g," \n "):void 0})};var n}function Mo(e,t){return{connectionId:e.connectionId,answerTo:e.requestId,method:e.method,return:t}}!function(e){var t,n=new vr;if("undefined"!=typeof self&&"object"==typeof self.onconnect){var r=new Map;self.onconnect=e=>{var t=e.ports[0];t.onmessage=e=>{var o=e.data;r.set(o.connectionId,t),n.next(o)}},t={storage:e.storage,messages$:n,send(e){Jt(r,e.connectionId).postMessage(e)}}}else addEventListener("message",(e=>{var t=e.data;n.next(t)})),t={storage:e.storage,messages$:n,send(e){postMessage(e)}};!function(e){var t=new Map;function n(t){if(e.storage)return e.storage.createStorageInstance(t);if(e.database){var n=Array.from(e.database.storageInstances),r=t.collectionName,o=n.find((e=>e.collectionName===r));if(!o)throw console.dir(n),new Error("storageInstance does not exist "+JSON.stringify({collectionName:r}));var i=t.schema;if(!Do(i,o.schema))throw new Error("Wrong schema "+JSON.stringify({schema:i,existingSchema:o.schema}));return Promise.resolve(o)}throw new Error("no base given")}e.messages$.pipe($o((e=>"custom"===e.method))).subscribe((async t=>{if(e.customRequestHandler)try{var n=await e.customRequestHandler(t.params);e.send(Mo(t,n))}catch(n){e.send(Ao(t,n))}else e.send(Ao(t,new Error("Remote storage: cannot resolve custom request because settings.customRequestHandler is not set")))}));var r=e.fakeVersion?e.fakeVersion:Vt;e.messages$.pipe($o((e=>"create"===e.method))).subscribe((async o=>{if(o.version===r){var i=o.connectionId;if(!Array.isArray(o.params)){var s=o.params,a=s.collectionName,c=[s.databaseName,s.collectionName,s.schema.version].join("|"),u=t.get(c);if(u){if(!Do(s.schema,u.params.schema))return void e.send(Ao(o,new Error("Remote storage: schema not equal to existing storage")))}else try{u={storageInstancePromise:n(s),connectionIds:new Set,params:s},t.set(c,u),await u.storageInstancePromise}catch(t){return void e.send(Ao(o,t))}u.connectionIds.add(o.connectionId);var l=[],f=await u.storageInstancePromise;l.push(f.changeStream().subscribe((t=>{var n={connectionId:i,answerTo:"changestream",method:"changeStream",return:t};e.send(n)})));var h=!1;if(e.database){var p=e.database,m=p.collections[a];m?m.onClose.push((()=>v())):p.onClose.push((()=>v()))}l.push(e.messages$.pipe($o((e=>e.connectionId===i))).subscribe((async t=>{var n,r=t;if("create"!==r.method&&"custom"!==r.method&&Array.isArray(r.params))try{if("close"===r.method&&e.database)return void e.send(Mo(r,null));if("close"===r.method&&S(u).connectionIds.size>1)return e.send(Mo(r,null)),S(u).connectionIds.delete(i),void l.forEach((e=>e.unsubscribe()));n="getChangedDocumentsSince"!==r.method||f.getChangedDocumentsSince?await f[r.method](r.params[0],r.params[1],r.params[2],r.params[3]):await Wt(f,r.params[0],r.params[1]),"close"!==r.method&&"remove"!==r.method||v(),e.send(Mo(r,n))}catch(t){e.send(Ao(r,t))}}))),e.send(Mo(o,"ok"))}}else e.send(Ao(o,d("RM1",{args:{mainVersion:o.version,remoteVersion:r}})));function v(){h||(h=!0,l.forEach((e=>e.unsubscribe())),S(u).connectionIds.delete(i),t.delete(c))}}))}(t)}({storage:function(e={}){var t=e.IDBKeyRange?e.IDBKeyRange:IDBKeyRange,n=e.indexedDB?e.indexedDB:indexedDB,r=Object.assign({batchSize:300,transactionDurability:"relaxed"},e,{IDBKeyRange:t,indexedDB:n});return new No(r)}({})})})();