(()=>{function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(t){var n=function(t,n){if("object"!=e(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var o=r.call(t,n||"default");if("object"!=e(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(t)}(t,"string");return"symbol"==e(n)?n:n+""}function n(e,n){for(var r=0;r<n.length;r++){var o=n[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,t(o.key),o)}}function r(e,t){return r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},r(e,t)}function o(e){return o=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},o(e)}function i(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(i=function(){return!!e})()}function s(e){var t="function"==typeof Map?new Map:void 0;return s=function(e){if(null===e||!function(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return function(e,t,n){if(i())return Reflect.construct.apply(null,arguments);var o=[null];o.push.apply(o,t);var s=new(e.bind.apply(e,o));return n&&r(s,n.prototype),s}(e,arguments,o(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),r(n,e)},s(e)}var a={isDevMode:()=>!1,deepFreezeWhenDevMode:e=>e,tunnelErrorMessage:e=>"\n        RxDB Error-Code: "+e+".\n        Hint: Error messages are not included in RxDB core to reduce build size.\n        To show the full error messages and to ensure that you do not make any mistakes when using RxDB,\n        use the dev-mode plugin when you are in development mode: https://rxdb.info/dev-mode.html?console=error\n        "};function c(e,t,n){return"\n"+e+"\n"+function(e){var t="";return 0===Object.keys(e).length?t:(t+="-".repeat(20)+"\n",t+="Parameters:\n",t+=Object.keys(e).map((t=>{var n="[object Object]";try{n="errors"===t?e[t].map((e=>JSON.stringify(e,Object.getOwnPropertyNames(e)))):JSON.stringify(e[t],(function(e,t){return void 0===t?null:t}),2)}catch(e){}return t+": "+n})).join("\n"),t+="\n")}(n)}var u=function(e){function t(t,n,r={}){var o,i=c(n,0,r);return(o=e.call(this,i)||this).code=t,o.message=i,o.url=l(t),o.parameters=r,o.rxdb=!0,o}var o,i;return i=e,(o=t).prototype=Object.create(i.prototype),o.prototype.constructor=o,r(o,i),t.prototype.toString=function(){return this.message},function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(t,[{key:"name",get:function(){return"RxError ("+this.code+")"}},{key:"typeError",get:function(){return!1}}])}(s(Error));function l(e){return"https://rxdb.info/errors.html?console=errors#"+e}function f(e){return"\nFind out more about this error here: "+l(e)+" \n"}function d(e,t){return new u(e,a.tunnelErrorMessage(e)+f(e),t)}var h=/\./g,p="abcdefghijklmnopqrstuvwxyz",m=e=>{var t=typeof e;return null!==e&&("object"===t||"function"===t)},v=new Set(["__proto__","prototype","constructor"]),y=new Set("0123456789");function b(e){var t=[],n="",r="start",o=!1;for(var i of e)switch(i){case"\\":if("index"===r)throw new Error("Invalid character in an index");if("indexEnd"===r)throw new Error("Invalid character after an index");o&&(n+=i),r="property",o=!o;break;case".":if("index"===r)throw new Error("Invalid character in an index");if("indexEnd"===r){r="property";break}if(o){o=!1,n+=i;break}if(v.has(n))return[];t.push(n),n="",r="property";break;case"[":if("index"===r)throw new Error("Invalid character in an index");if("indexEnd"===r){r="index";break}if(o){o=!1,n+=i;break}if("property"===r){if(v.has(n))return[];t.push(n),n=""}r="index";break;case"]":if("index"===r){t.push(Number.parseInt(n,10)),n="",r="indexEnd";break}if("indexEnd"===r)throw new Error("Invalid character after an index");default:if("index"===r&&!y.has(i))throw new Error("Invalid character in an index");if("indexEnd"===r)throw new Error("Invalid character after an index");"start"===r&&(r="property"),o&&(o=!1,n+="\\"),n+=i}switch(o&&(n+="\\"),r){case"property":if(v.has(n))return[];t.push(n);break;case"index":throw new Error("Index was not closed");case"start":t.push("")}return t}function g(e,t){if("number"!=typeof t&&Array.isArray(e)){var n=Number.parseInt(t,10);return Number.isInteger(n)&&e[n]===e[t]}return!1}function w(e,t){var n=function(e,t,n){if(Array.isArray(t)&&(t=t.join(".")),!t.includes(".")&&!t.includes("["))return e[t];if(!m(e)||"string"!=typeof t)return void 0===n?e:n;var r=b(t);if(0===r.length)return n;for(var o=0;o<r.length;o++){var i=r[o];if(null==(e=g(e,i)?o===r.length-1?void 0:null:e[i])){if(o!==r.length-1)return n;break}}return void 0===e?n:e}(e,function(e){for(;"."===e.charAt(0);)e=e.substr(1);for(;"."===e.slice(-1);)e=e.slice(0,-1);return e}("properties."+t.replace(h,".properties.")));return n}function x(e){return"string"==typeof e?e:e.key}function S(e,t){if(!e)throw t||(t=""),new Error("ensureNotFalsy() is falsy: "+t);return e}function O(e){var t=e.split("."),n=t.length;return 1===n?t=>t[e]:e=>{for(var r=e,o=0;o<n;++o)if(void 0===(r=r[t[o]]))return r;return r}}function I(e){return Object.assign({},e)}var E=function e(t){if(!t)return t;if(null===t||"object"!=typeof t)return t;if(Array.isArray(t)){for(var n=new Array(t.length),r=n.length;r--;)n[r]=e(t[r]);return n}var o={};for(var i in t)o[i]=e(t[i]);return o};function _(e){return e[e.length-1]}function j(e,t){var n=0,r=-1;for(var o of e){if(!t(o,r+=1))break;n+=1}return n}var k=String.fromCharCode(65535),P=Number.MIN_SAFE_INTEGER;function N(e,t){var n=t.selector,r=e.indexes?e.indexes.slice(0):[];t.index&&(r=[t.index]);var o=!!t.sort.find((e=>"desc"===Object.values(e)[0])),i=new Set;Object.keys(n).forEach((t=>{var r=w(e,t);r&&"boolean"===r.type&&Object.prototype.hasOwnProperty.call(n[t],"$eq")&&i.add(t)}));var s,a=t.sort.map((e=>Object.keys(e)[0])).filter((e=>!i.has(e))).join(","),c=-1;if(r.forEach((e=>{var r=!0,u=!0,l=e.map((e=>{var t=n[e],o=t?Object.keys(t):[],i={};return t&&o.length?o.forEach((e=>{if(A.has(e)){var n=function(e,t){switch(e){case"$eq":return{startKey:t,endKey:t,inclusiveEnd:!0,inclusiveStart:!0};case"$lte":return{endKey:t,inclusiveEnd:!0};case"$gte":return{startKey:t,inclusiveStart:!0};case"$lt":return{endKey:t,inclusiveEnd:!1};case"$gt":return{startKey:t,inclusiveStart:!1};default:throw new Error("SNH")}}(e,t[e]);i=Object.assign(i,n)}})):i={startKey:u?P:k,endKey:r?k:P,inclusiveStart:!0,inclusiveEnd:!0},void 0===i.startKey&&(i.startKey=P),void 0===i.endKey&&(i.endKey=k),void 0===i.inclusiveStart&&(i.inclusiveStart=!0),void 0===i.inclusiveEnd&&(i.inclusiveEnd=!0),u&&!i.inclusiveStart&&(u=!1),r&&!i.inclusiveEnd&&(r=!1),i})),f=l.map((e=>e.startKey)),d=l.map((e=>e.endKey)),h={index:e,startKeys:f,endKeys:d,inclusiveEnd:r,inclusiveStart:u,sortSatisfiedByIndex:!o&&a===e.filter((e=>!i.has(e))).join(","),selectorSatisfiedByIndex:M(e,t.selector,f,d)},p=function(e,t,n){var r=0,o=e=>{e>0&&(r+=e)},i=10,s=j(n.startKeys,(e=>e!==P&&e!==k));o(s*i);var a=j(n.startKeys,(e=>e!==k&&e!==P));o(a*i);var c=j(n.startKeys,((e,t)=>e===n.endKeys[t]));return o(c*i*1.5),o(n.sortSatisfiedByIndex?5:0),r}(0,0,h);(p>=c||t.index)&&(c=p,s=h)})),!s)throw d("SNH",{query:t});return s}var A=new Set(["$eq","$gt","$gte","$lt","$lte"]),$=new Set(["$eq","$gt","$gte"]),D=new Set(["$eq","$lt","$lte"]);function M(e,t,n,r){var o=Object.entries(t).find((([t,n])=>!e.includes(t)||Object.entries(n).find((([e,t])=>!A.has(e)))));if(o)return!1;if(t.$and||t.$or)return!1;var i=[],s=new Set;for(var[a,c]of Object.entries(t)){if(!e.includes(a))return!1;var u=Object.keys(c).filter((e=>$.has(e)));if(u.length>1)return!1;var l=u[0];if(l&&s.add(a),"$eq"!==l){if(i.length>0)return!1;i.push(l)}}var f=[],d=new Set;for(var[h,p]of Object.entries(t)){if(!e.includes(h))return!1;var m=Object.keys(p).filter((e=>D.has(e)));if(m.length>1)return!1;var v=m[0];if(v&&d.add(h),"$eq"!==v){if(f.length>0)return!1;f.push(v)}}var y=0;for(var b of e){for(var g of[s,d]){if(!g.has(b)&&g.size>0)return!1;g.delete(b)}if(n[y]!==r[y]&&s.size>0&&d.size>0)return!1;y++}return!0}class C extends Error{}const T=Number.MAX_SAFE_INTEGER,B=Number.MIN_SAFE_INTEGER,R=Symbol("missing"),L=Object.freeze(new Error("mingo: cycle detected while processing object/array")),K=/^\[object ([a-zA-Z0-9]+)\]$/,q=e=>{const t=ge(e);let n=0,r=t.length;for(;r;)n=(n<<5)-n^t.charCodeAt(--r);return n>>>0},F=new Set(["null","undefined","boolean","number","string","date","regexp"]),U={null:0,undefined:0,number:1,string:2,object:3,array:4,boolean:5,date:6,regexp:7,function:8},z=(e,t)=>{e===R&&(e=void 0),t===R&&(t=void 0);const[n,r]=[e,t].map((e=>U[W(e).toLowerCase()]));return n!==r?n-r:1===n||2===n||6===n?e<t?-1:e>t?1:0:ye(e,t)?0:e<t?-1:e>t?1:0};function V(e,t){if(!e)throw new C(t)}const W=e=>K.exec(Object.prototype.toString.call(e))[1],J=e=>"boolean"==typeof e,H=e=>"string"==typeof e,G=e=>!isNaN(e)&&"number"==typeof e,Y=Array.isArray,Q=e=>{if(!e)return!1;const t=Object.getPrototypeOf(e);return(t===Object.prototype||null===t)&&"[object Object]"===Object.prototype.toString.call(e)},X=e=>e===Object(e),Z=e=>e instanceof Date,ee=e=>e instanceof RegExp,te=e=>"function"==typeof e,ne=e=>null==e,re=(e,t)=>e.includes(t),oe=(e,t)=>!re(e,t),ie=e=>ne(e)||H(e)&&!e||e instanceof Array&&0===e.length||Q(e)&&0===Object.keys(e).length,se=e=>e===R,ae=e=>e instanceof Array?e:[e],ce=(e,t)=>!!e&&Object.prototype.hasOwnProperty.call(e,t),ue=e=>"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView(e),le=[Z,ee,ue],fe=(e,t)=>{if(ne(e))return e;if(t.has(e))throw L;const n=e.constructor;if(le.some((t=>t(e))))return new n(e);try{if(t.add(e),Y(e))return e.map((e=>fe(e,t)));if(Q(e)){const n={};for(const r in e)n[r]=fe(e[r],t);return n}}finally{t.delete(e)}return e},de=e=>fe(e,new Set);function he(e,t,n){if(n=n||{flatten:!1},se(e)||ne(e))return t;if(se(t)||ne(t))return e;if(o=t,!(Q(r=e)&&Q(o)||Y(r)&&Y(o))){if(n.skipValidation)return t||e;throw Error("mismatched types. must both be array or object")}var r,o;if(n.skipValidation=!0,Y(e)){const r=e,o=t;if(n.flatten){let e=0,i=0;for(;e<r.length&&i<o.length;)r[e]=he(r[e++],o[i++],n);for(;i<o.length;)r.push(t[i++])}else Oe(r,o)}else for(const r in t)e[r]=he(e[r],t[r],n);return e}function pe(e,t=q){const n=new Map;return e.forEach(((r,o)=>{const i=we(r,t);n.has(i)?n.get(i).some((t=>ye(e[t],r)))||n.get(i).push(o):n.set(i,[o])})),n}function me(e,t=q){if(e.some((e=>0==e.length)))return[];if(1===e.length)return Array.from(e);const n=function(e,t,n=z){if(ie(e))return e;const r=new Array,o=new Array;for(let n=0;n<e.length;n++){const i=e[n],s=t(i,n);ne(s)?o.push(i):r.push([s,i])}return r.sort(((e,t)=>n(e[0],t[0]))),Oe(o,r.map((e=>e[1])))}(e.map(((e,t)=>[t,e.length])),(e=>e[1])),r=e[n[0][0]],o=pe(r,t),i=new Map,s=new Array;return o.forEach(((t,o)=>{const a=t.map((e=>r[e])),c=a.map((e=>0)),u=a.map((e=>[n[0][0],0]));let l=!1;for(let t=1;t<e.length;t++){const[r,s]=n[t],f=e[r];if(i.has(t)||i.set(t,pe(f)),i.get(t).has(o)){const e=i.get(t).get(o).map((e=>f[e]));l=a.map(((n,s)=>e.some(((e,a)=>{const l=c[s];return ye(n,e)&&(c[s]++,r<u[s][0]&&(u[s]=[r,i.get(t).get(o)[a]])),l<c[s]})))).some(Boolean)}if(!l)return}l&&Oe(s,c.map(((t,n)=>t===e.length-1?[a[n],u[n]]:R)).filter((e=>e!==R)))})),s.sort(((e,t)=>{const[n,[r,o]]=e,[i,[s,a]]=t,c=z(r,s);return 0!==c?c:z(o,a)})).map((e=>e[0]))}function ve(e,t=0){const n=new Array;return function e(t,r){for(let o=0,i=t.length;o<i;o++)Y(t[o])&&(r>0||r<0)?e(t[o],Math.max(-1,r-1)):n.push(t[o])}(e,t),n}function ye(e,t){if(e===t||Object.is(e,t))return!0;const n=!!e&&e.constructor||e;if(null===e||null===t||void 0===e||void 0===t||n!==t.constructor||n===Function)return!1;if(n===Array||n===Object){const n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;if(new Set([...n,...r]).size!=n.length)return!1;for(const r of n)if(!ye(e[r],t[r]))return!1;return!0}const r=Object.getPrototypeOf(e);return(ue(e)||r!==Object.prototype&&r!==Array.prototype&&Object.prototype.hasOwnProperty.call(r,"toString"))&&e.toString()===t.toString()}const be=(e,t)=>{if(null===e)return"null";if(void 0===e)return"undefined";const n=e.constructor;switch(n){case RegExp:case Number:case Boolean:case Function:case Symbol:return e.toString();case String:return JSON.stringify(e);case Date:return e.toISOString()}if(ue(e))return n.name+"["+e.toString()+"]";if(t.has(e))throw L;try{if(t.add(e),Y(e))return"["+e.map((e=>be(e,t))).join(",")+"]";if(n===Object)return"{"+Object.keys(e).sort().map((n=>n+":"+be(e[n],t))).join(",")+"}";const r=Object.getPrototypeOf(e);if(r!==Object.prototype&&r!==Array.prototype&&Object.prototype.hasOwnProperty.call(r,"toString"))return n.name+"("+JSON.stringify(e.toString())+")";const[o,i]=(e=>{let[t,n]=[Object.getPrototypeOf(e),Object.getOwnPropertyNames(e)],r=t;for(;!n.length&&t!==Object.prototype&&t!==Array.prototype;)r=t,n=Object.getOwnPropertyNames(t),t=Object.getPrototypeOf(t);const o={};return n.forEach((t=>o[t]=e[t])),[o,r]})(e);return n.name+be(o,t)}finally{t.delete(e)}},ge=e=>be(e,new Set);function we(e,t){return t=t||q,ne(e)?null:t(e).toString()}function xe(e,t,n=q){if(e.length<1)return new Map;const r=new Map,o=new Map;for(let i=0;i<e.length;i++){const s=e[i],a=t(s,i),c=we(a,n);if(null===c)o.has(null)?o.get(null).push(s):o.set(null,[s]);else{const e=r.has(c)?r.get(c).find((e=>ye(e,a))):null;ne(e)?(o.set(a,[s]),r.has(c)?r.get(c).push(a):r.set(c,[a])):o.get(e).push(s)}}return o}const Se=5e4;function Oe(e,...t){return e instanceof Array?t.reduce(((e,t)=>{let n=Math.ceil(t.length/Se),r=0;for(;n-- >0;)Array.prototype.push.apply(e,t.slice(r,r+Se)),r+=Se;return e}),e):t.filter(X).reduce(((e,t)=>(Object.assign(e,t),e)),e)}function Ie(e,t){return X(e)?e[t]:void 0}function Ee(e,t,n){let r=0;const o=F.has(W(e).toLowerCase())?e:function e(t,n){let o=t;for(let t=0;t<n.length;t++){const i=n[t];if(null===/^\d+$/.exec(i)&&o instanceof Array){if(0===t&&r>0)break;r+=1;const i=n.slice(t);o=o.reduce(((t,n)=>{const r=e(n,i);return void 0!==r&&t.push(r),t}),[]);break}if(o=Ie(o,i),void 0===o)break}return o}(e,t.split("."));return o instanceof Array&&n?.unwrapArray?function(e,t){if(t<1)return e;for(;t--&&1===e.length;)e=e[0];return e}(o,r):o}function _e(e,t,n){const r=t.split("."),o=r[0],i=r.slice(1).join("."),s=null!==/^\d+$/.exec(o),a=r.length>1;let c,u;if(e instanceof Array)if(s)c=Ie(e,Number(o)),a&&(c=_e(c,i,n)),c=[c];else{c=[];for(const r of e)u=_e(r,t,n),n?.preserveMissing?(void 0===u&&(u=R),c.push(u)):void 0!==u&&c.push(u)}else{if(u=Ie(e,o),a&&(u=_e(u,i,n)),void 0===u)return;c=n?.preserveKeys?{...e}:{},c[o]=u}return c}function je(e){if(e instanceof Array)for(let t=e.length-1;t>=0;t--)e[t]===R?e.splice(t,1):je(e[t]);else if(Q(e))for(const t in e)ce(e,t)&&je(e[t])}const ke=/^\d+$/;function Pe(e,t,n,r){const o=t.split("."),i=o[0],s=o.slice(1).join(".");if(1===o.length)(Q(e)||Y(e)&&ke.test(i))&&n(e,i);else{r?.buildGraph&&ne(e[i])&&(e[i]={});const t=e[i];if(!t)return;const a=!!(o.length>1&&ke.test(o[1]));t instanceof Array&&r?.descendArray&&!a?t.forEach((e=>Pe(e,s,n,r))):Pe(t,s,n,r)}}function Ne(e,t,n){Pe(e,t,((e,t)=>{e[t]=te(n)?n(e[t]):n}),{buildGraph:!0})}function Ae(e,t,n){Pe(e,t,((e,t)=>{if(e instanceof Array){if(/^\d+$/.test(t))e.splice(parseInt(t),1);else if(n&&n.descendArray)for(const n of e)Q(n)&&delete n[t]}else Q(e)&&delete e[t]}),n)}const $e=/^\$[a-zA-Z0-9_]+$/;function De(e){return $e.test(e)}function Me(e){if(F.has(W(e).toLowerCase()))return ee(e)?{$regex:e}:{$eq:e};if(X(e)){const t=e;if(!Object.keys(t).some(De))return{$eq:e};if(ce(e,"$regex")){const t={...e};return t.$regex=new RegExp(e.$regex,e.$options),delete t.$options,t}}return e}var Ce=(e=>(e.CLONE_ALL="CLONE_ALL",e.CLONE_INPUT="CLONE_INPUT",e.CLONE_OUTPUT="CLONE_OUTPUT",e.CLONE_OFF="CLONE_OFF",e))(Ce||{});class Te{constructor(e,t,n,r=Date.now()){this._opts=e,this._root=t,this._local=n,this.timestamp=r,this.update(t,n)}static init(e,t,n){return e instanceof Te?new Te(e._opts,ne(e.root)?t:e.root,Object.assign({},e.local,n)):new Te(e,t,n)}update(e,t){return this._root=e,this._local=t?Object.assign({},t,{variables:Object.assign({},this._local?.variables,t?.variables)}):t,this}getOptions(){return Object.freeze({...this._opts,context:Le.from(this._opts.context)})}get root(){return this._root}get local(){return this._local}get idKey(){return this._opts.idKey}get collation(){return this._opts?.collation}get processingMode(){return this._opts?.processingMode||"CLONE_OFF"}get useStrictMode(){return this._opts?.useStrictMode}get scriptEnabled(){return this._opts?.scriptEnabled}get useGlobalContext(){return this._opts?.useGlobalContext}get hashFunction(){return this._opts?.hashFunction}get collectionResolver(){return this._opts?.collectionResolver}get jsonSchemaValidator(){return this._opts?.jsonSchemaValidator}get variables(){return this._opts?.variables}get context(){return this._opts?.context}}function Be(e){return e instanceof Te?e.getOptions():Object.freeze({idKey:"_id",scriptEnabled:!0,useStrictMode:!0,useGlobalContext:!0,processingMode:"CLONE_OFF",...e,context:e?.context?Le.from(e?.context):Le.init({})})}var Re=(e=>(e.ACCUMULATOR="accumulator",e.EXPRESSION="expression",e.PIPELINE="pipeline",e.PROJECTION="projection",e.QUERY="query",e.WINDOW="window",e))(Re||{});class Le{constructor(e){this.operators={accumulator:{},expression:{},pipeline:{},projection:{},query:{},window:{}};for(const[t,n]of Object.entries(e))this.addOperators(t,n)}static init(e={}){return new Le(e)}static from(e){return new Le(e.operators)}addOperators(e,t){for(const[n,r]of Object.entries(t))this.getOperator(e,n)||(this.operators[e][n]=r);return this}addAccumulatorOps(e){return this.addOperators("accumulator",e)}addExpressionOps(e){return this.addOperators("expression",e)}addQueryOps(e){return this.addOperators("query",e)}addPipelineOps(e){return this.addOperators("pipeline",e)}addProjectionOps(e){return this.addOperators("projection",e)}addWindowOps(e){return this.addOperators("window",e)}getOperator(e,t){return e in this.operators&&this.operators[e][t]||null}}const Ke=Le.init();function qe(e,t){for(const[n,r]of Object.entries(t)){V(te(r)&&De(n),`'${n}' is not a valid operator`);const t=Fe(e,n,null);V(!t||r===t,`${n} already exists for '${e}' operators. Cannot change operator function once registered.`)}switch(e){case"accumulator":Ke.addAccumulatorOps(t);break;case"expression":Ke.addExpressionOps(t);break;case"pipeline":Ke.addPipelineOps(t);break;case"projection":Ke.addProjectionOps(t);break;case"query":Ke.addQueryOps(t);break;case"window":Ke.addWindowOps(t)}}function Fe(e,t,n){const{context:r,useGlobalContext:o}=n||{},i=r?r.getOperator(e,t):null;return!i&&o?Ke.getOperator(e,t):i}const Ue={$$ROOT:(e,t,n)=>n.root,$$CURRENT:(e,t,n)=>e,$$REMOVE(e,t,n){},$$NOW:(e,t,n)=>new Date(n.timestamp)},ze={$$KEEP:(e,t,n)=>e,$$PRUNE(e,t,n){},$$DESCEND(e,t,n){if(!ce(t,"$cond"))return e;let r;for(const[o,i]of Object.entries(e))if(X(i)){if(i instanceof Array){const e=[];for(let r of i)Q(r)&&(r=We(r,t,n.update(r))),ne(r)||e.push(r);r=e}else r=We(i,t,n.update(i));ne(r)?delete e[o]:e[o]=r}return e}};function Ve(e,t,n,r){const o=Te.init(r,e);if(De(n=n||"")){const i=Fe("expression",n,r);if(i)return i(e,t,o);const s=Fe("accumulator",n,r);if(s)return e instanceof Array||(e=Ve(e,t,null,o),t=null),V(e instanceof Array,`'${n}' target must be an array.`),s(e,t,o.update(null,o.local));throw new C(`operator '${n}' is not registered`)}if(H(t)&&t.length>0&&"$"===t[0]){if(ce(ze,t))return t;let n=o.root;const r=t.split(".");if(ce(Ue,r[0]))n=Ue[r[0]](e,null,o),t=t.slice(r[0].length+1);else if("$$"===r[0].slice(0,2)){n=Object.assign({},o.variables,{this:e},o.local?.variables);const i=r[0].slice(2);V(ce(n,i),`Use of undefined variable: ${i}`),t=t.slice(2)}else t=t.slice(1);return""===t?n:Ee(n,t)}if(Y(t))return t.map((t=>Ve(e,t,null,o)));if(Q(t)){const n={};for(const[i,s]of Object.entries(t))if(n[i]=Ve(e,s,i,o),["expression","accumulator"].some((e=>!!Fe(e,i,r))))return V(1===Object.keys(t).length,"Invalid aggregation expression '"+JSON.stringify(t)+"'"),n[i];return n}return t}function We(e,t,n){const r=Ve(e,t,null,n);return ce(ze,r)?ze[r](e,t,n):r}function Je(e){return e instanceof Ye?e:new Ye(e)}function He(e,t){const n=e.slice(t+1);e.splice(t),Array.prototype.push.apply(e,n)}const Ge=new Error;class Ye{constructor(e){let t;if(this.iteratees=[],this.yieldedValues=[],this.isDone=!1,e instanceof Function&&(e={next:e}),(n=e)&&"object"==typeof n&&n?.next instanceof Function){const n=e;t=()=>{const e=n.next();if(e.done)throw Ge;return e.value}}else if(e instanceof Array){const n=e,r=n.length;let o=0;t=()=>{if(o<r)return n[o++];throw Ge}}else if(!(e instanceof Function))throw new C("Lazy must be initialized with an array, generator, or function.");var n;this.getNext=function(e,t,n){let r=!1,o=-1,i=0;return function(s){try{e:for(;!r;){let a=e();o++;let c=-1;const u=t.length;let l=!1;for(;++c<u;){const e=t[c];switch(e.action){case 0:a=e.func(a,o);break;case 1:if(!e.func(a,o))continue e;break;case 2:--e.count,e.count||(l=!0);break;case 3:--e.count,e.count||He(t,c);continue e;default:break e}}if(r=l,!s)return{value:a,done:!1};n[i++]=a}}catch(e){if(e!==Ge)throw e}return r=!0,{done:r}}}(t,this.iteratees,this.yieldedValues)}push(e,t){return"function"==typeof t?this.iteratees.push({action:e,func:t}):"number"==typeof t&&this.iteratees.push({action:e,count:t}),this}next(){return this.getNext()}map(e){return this.push(0,e)}filter(e){return this.push(1,e)}take(e){return e>0?this.push(2,e):this}drop(e){return e>0?this.push(3,e):this}transform(e){const t=this;let n;return Je((()=>(n||(n=Je(e(t.value()))),n.next())))}value(){return this.isDone||(this.isDone=this.getNext(!0).done),this.yieldedValues}each(e){for(;;){const t=this.next();if(t.done)break;if(!1===e(t.value))return!1}return!0}reduce(e,t){let n=this.next();for(void 0!==t||n.done||(t=n.value,n=this.next());!n.done;)t=e(t,n.value),n=this.next();return t}size(){return this.reduce(((e,t)=>++e),0)}[Symbol.iterator](){return this}}class Qe{constructor(e,t){this.pipeline=e,this.options=Be(t)}stream(e){let t=Je(e);const n=this.options.processingMode;n!=Ce.CLONE_ALL&&n!=Ce.CLONE_INPUT||t.map(de);const r=new Array;if(!ie(this.pipeline))for(const e of this.pipeline){const n=Object.keys(e),o=n[0],i=Fe(Re.PIPELINE,o,this.options);V(1===n.length&&!!i,`invalid pipeline operator ${o}`),r.push(o),t=i(t,e[o],this.options)}return(n==Ce.CLONE_OUTPUT||n==Ce.CLONE_ALL&&me([["$group","$unwind"],r]).length)&&t.map(de),t}run(e){return this.stream(e).value()}}class Xe{constructor(e,t,n,r){this.source=e,this.predicate=t,this.projection=n,this.options=r,this.operators=[],this.result=null,this.buffer=[]}fetch(){return this.result||(Q(this.projection)&&this.operators.push({$project:this.projection}),this.result=Je(this.source).filter(this.predicate),this.operators.length>0&&(this.result=new Qe(this.operators,this.options).stream(this.result))),this.result}fetchAll(){const e=Je([...this.buffer]);return this.buffer=[],function(...e){let t=0;return Je((()=>{for(;t<e.length;){const n=e[t].next();if(!n.done)return n;t++}return{done:!0}}))}(e,this.fetch())}all(){return this.fetchAll().value()}count(){return this.all().length}skip(e){return this.operators.push({$skip:e}),this}limit(e){return this.operators.push({$limit:e}),this}sort(e){return this.operators.push({$sort:e}),this}collation(e){return this.options={...this.options,collation:e},this}next(){if(this.buffer.length>0)return this.buffer.pop();const e=this.fetch().next();return e.done?void 0:e.value}hasNext(){if(this.buffer.length>0)return!0;const e=this.fetch().next();return!e.done&&(this.buffer.push(e.value),!0)}map(e){return this.all().map(e)}forEach(e){this.all().forEach(e)}[Symbol.iterator](){return this.fetchAll()}}class Ze{constructor(e,t){this.condition=e,this.options=Be(t),this.compiled=[],this.compile()}compile(){V(Q(this.condition),`query criteria must be an object: ${JSON.stringify(this.condition)}`);const e={};for(const[t,n]of Object.entries(this.condition)){if("$where"===t)Object.assign(e,{field:t,expr:n});else if(re(["$and","$or","$nor","$expr","$jsonSchema"],t))this.processOperator(t,t,n);else{V(!De(t),`unknown top level operator: ${t}`);for(const[e,r]of Object.entries(Me(n)))this.processOperator(t,e,r)}e.field&&this.processOperator(e.field,e.field,e.expr)}}processOperator(e,t,n){const r=Fe(Re.QUERY,t,this.options);if(!r)throw new C(`unknown query operator ${t}`);const o=r(e,n,this.options);this.compiled.push(o)}test(e){for(let t=0,n=this.compiled.length;t<n;t++)if(!this.compiled[t](e))return!1;return!0}find(e,t){return new Xe(e,(e=>this.test(e)),t||{},this.options)}remove(e){return e.reduce(((e,t)=>(this.test(t)||e.push(t),e)),[])}}const et=(e,t,n)=>{if(ie(t)||!Q(t))return e;let r=z;const o=n.collation;return Q(o)&&H(o.locale)&&(r=function(e){const t={sensitivity:tt[e.strength||3],caseFirst:"off"===e.caseFirst?"false":e.caseFirst||"false",numeric:e.numericOrdering||!1,ignorePunctuation:"shifted"===e.alternate};!0===(e.caseLevel||!1)&&("base"===t.sensitivity&&(t.sensitivity="case"),"accent"===t.sensitivity&&(t.sensitivity="variant"));const n=new Intl.Collator(e.locale,t);return(e,t)=>{if(!H(e)||!H(t))return z(e,t);const r=n.compare(e,t);return r<0?-1:r>0?1:0}}(o)),e.transform((e=>{const o=Object.keys(t);for(const i of o.reverse()){const o=xe(e,(e=>Ee(e,i)),n.hashFunction),s=Array.from(o.keys()).sort(r);-1===t[i]&&s.reverse(),e=[],s.reduce(((e,t)=>Oe(e,o.get(t))),e)}return e}))},tt={1:"base",2:"accent",3:"variant"};function nt(e){const t=(t,n,r)=>{const o={unwrapArray:!0},i=Math.max(1,t.split(".").length-1);return s=>{const a=Ee(s,t,o);return e(a,n,{...r,depth:i})}};return t.op="query",t}function rt(e){return(t,n,r)=>{const o=Ve(t,n,null,r);return e(...o)}}function ot(e,t,n){if(ye(e,t))return!0;if(ne(e)&&ne(t))return!0;if(e instanceof Array){const r=ye.bind(null,t);return e.some(r)||ve(e,n?.depth).some(r)}return!1}function it(e,t,n){return!ot(e,t,n)}function st(e,t,n){return ne(e)?t.some((e=>null===e)):me([ae(e),t],n?.hashFunction).length>0}function at(e,t,n){return!st(e,t,n)}function ct(e,t,n){return gt(e,t,((e,t)=>z(e,t)<0))}function ut(e,t,n){return gt(e,t,((e,t)=>z(e,t)<=0))}function lt(e,t,n){return gt(e,t,((e,t)=>z(e,t)>0))}function ft(e,t,n){return gt(e,t,((e,t)=>z(e,t)>=0))}function dt(e){return De(e)&&-1===["$and","$or","$nor"].indexOf(e)}function ht(e,t,n){if(Y(e)&&!ie(e)){let r=e=>e,o=t;Object.keys(t).every(dt)&&(o={temp:t},r=e=>({temp:e}));const i=new Ze(o,n);for(let t=0,n=e.length;t<n;t++)if(i.test(r(e[t])))return!0}return!1}const pt=e=>null===e,mt=e=>G(e)&&e>=-2147483648&&e<=2147483647&&-1===e.toString().indexOf("."),vt=e=>G(e)&&e>=B&&e<=T&&-1===e.toString().indexOf("."),yt={array:Y,bool:J,boolean:J,date:Z,decimal:G,double:G,int:mt,long:vt,number:G,null:pt,object:Q,regex:ee,regexp:ee,string:H,undefined:ne,function:e=>{throw new C("unsupported type key `function`.")},1:G,2:H,3:Q,4:Y,6:ne,8:J,9:Z,10:pt,11:ee,16:mt,18:vt,19:G};function bt(e,t,n){const r=yt[t];return!!r&&r(e)}function gt(e,t,n){return ae(e).some((e=>W(e)===W(t)&&n(e,t)))}rt(at);const wt=(e,t)=>(n,r,o)=>{V(Y(r),`${e}: expression must be an array.`);const i=Ve(n,r,null,o);return i.some(ne)?null:(V(i.every(G),`${e}: expression must evalue to array of numbers.`),t(i))};wt("$bitAnd",(e=>e.reduce(((e,t)=>e&t),-1))),wt("$bitOr",(e=>e.reduce(((e,t)=>e|t),0))),wt("$bitXor",(e=>e.reduce(((e,t)=>e^t),0))),rt(ot),rt(lt),rt(ft),rt(ct),rt(ut),rt(it);const xt=(e,t)=>{const n={};return e.split("").forEach(((e,r)=>n[e]=t*(r+1))),n};xt("ABCDEFGHIKLM",1),xt("NOPQRSTUVWXY",-1);const St={undefined:null,null:null,NaN:NaN,Infinity:new Error,"-Infinity":new Error};function Ot(e,t=St){const n=Object.assign({},St,t),r=new Set(Object.keys(n));return(t,o,i)=>{const s=Ve(t,o,null,i);if(r.has(`${s}`)){const t=n[`${s}`];if(t instanceof Error)throw new C(`cannot apply $${e.name} to -inf, value must in (-inf,inf)`);return t}return e(s)}}Ot(Math.acos,{Infinity:1/0,0:new Error}),Ot(Math.acosh,{Infinity:1/0,0:new Error}),Ot(Math.asin),Ot(Math.asinh,{Infinity:1/0,"-Infinity":-1/0}),Ot(Math.atan),Ot(Math.atanh,{1:1/0,"-1":-1/0}),Ot(Math.cos),Ot(Math.cosh,{"-Infinity":1/0,Infinity:1/0});const It=Math.PI/180,Et=(Ot((e=>e*It),{Infinity:1/0,"-Infinity":1/0}),180/Math.PI);Ot((e=>e*Et),{Infinity:1/0,"-Infinity":-1/0}),Ot(Math.sin),Ot(Math.sinh,{"-Infinity":-1/0,Infinity:1/0}),Ot(Math.tan);const _t=(e,t,n)=>{if(ie(t))return e;let r=Object.keys(t),o=!1;kt(t,n);const i=n.idKey;if(re(r,i)){const e=t[i];0!==e&&!1!==e||(r=r.filter(oe.bind(null,[i])),o=0==r.length)}else r.push(i);const s=Te.init(n);return e.map((e=>jt(e,t,s.update(e),r,o)))};function jt(e,t,n,r,o){let i={},s=!1,a=!1;const c=[];o&&c.push(n.idKey);for(const o of r){let r;const u=t[o];if(o!==n.idKey&&re([0,!1],u)&&(a=!0),o===n.idKey&&ie(u))r=e[o];else if(H(u))r=Ve(e,u,o,n);else if(re([1,!0],u));else if(u instanceof Array)r=u.map((t=>{const r=Ve(e,t,null,n);return ne(r)?null:r}));else{if(!Q(u)){c.push(o);continue}{const t=u,i=Object.keys(u),a=1==i.length?i[0]:"",c=Fe(Re.PROJECTION,a,n);if(c)"$slice"===a?ae(t[a]).every(G)?(r=c(e,t[a],o,n),s=!0):r=Ve(e,t,o,n):r=c(e,t[a],o,n);else if(De(a))r=Ve(e,t[a],a,n);else if(ce(e,o)){kt(t,n);let s=e[o];s instanceof Array?r=s.map((e=>jt(e,t,n,i,!1))):(s=Q(s)?s:e,r=jt(s,t,n,i,!1))}else r=Ve(e,u,null,n)}}const l=_e(e,o,{preserveMissing:!0});void 0!==l&&he(i,l,{flatten:!0}),oe([0,1,!1,!0],u)&&(void 0===r?Ae(i,o,{descendArray:!0}):Ne(i,o,r))}if(je(i),(s||a||o)&&(i=Oe({},e,i),c.length>0))for(const e of c)Ae(i,e,{descendArray:!0});return i}function kt(e,t){const n=[!1,!1];for(const[r,o]of Object.entries(e)){if(r===t?.idKey)return;0===o||!1===o?n[0]=!0:1!==o&&!0!==o||(n[1]=!0),V(!(n[0]&&n[1]),"Projection cannot have a mix of inclusion and exclusion.")}}const Pt=(e,t,n)=>{V(Y(t),"Invalid expression: $and expects value to be an Array.");const r=t.map((e=>new Ze(e,n)));return e=>r.every((t=>t.test(e)))},Nt=(e,t,n)=>{V(Y(t),"Invalid expression. $or expects value to be an Array");const r=t.map((e=>new Ze(e,n)));return e=>r.some((t=>t.test(e)))},At=(e,t,n)=>{V(Y(t),"Invalid expression. $nor expects value to be an array.");const r=Nt(0,t,n);return e=>!r(e)},$t=(e,t,n)=>{const r={};r[e]=Me(t);const o=new Ze(r,n);return e=>!o.test(e)},Dt=nt(ot),Mt=nt(lt),Ct=nt(ft),Tt=nt(st),Bt=nt(ct),Rt=nt(ut),Lt=nt(it),Kt=nt(at),qt=nt((function(e,t,n){return ae(e).some((e=>2===t.length&&e%t[0]===t[1]))})),Ft=nt((function(e,t,n){const r=ae(e),o=e=>H(e)&&((e,t=!0)=>!!e||t&&""===e)(t.exec(e),n?.useStrictMode);return r.some(o)||ve(r,1).some(o)}));nt((function(e,t,n){if(!(Y(e)&&Y(t)&&e.length&&t.length))return!1;let r=!0;for(const o of t){if(!r)break;r=Q(o)&&re(Object.keys(o),"$elemMatch")?ht(e,o.$elemMatch,n):o instanceof RegExp?e.some((e=>"string"==typeof e&&o.test(e))):e.some((e=>ye(o,e)))}return r}));const Ut=nt(ht),zt=nt((function(e,t,n){return Array.isArray(e)&&e.length===t})),Vt=nt((function(e,t,n){return(!1===t||0===t)&&void 0===e||(!0===t||1===t)&&void 0!==e})),Wt=nt((function(e,t,n){return Array.isArray(t)?t.findIndex((t=>bt(e,t)))>=0:bt(e,t)}));var Jt=!1;function Ht(e,t){var n=x(e.primaryKey);t=I(t);var r,o=E(t);if("number"!=typeof o.skip&&(o.skip=0),o.selector?(o.selector=o.selector,Object.entries(o.selector).forEach((([e,t])=>{"object"==typeof t&&null!==t||(o.selector[e]={$eq:t})}))):o.selector={},o.index){var i=(r=o.index,Array.isArray(r)?r.slice(0):[r]);i.includes(n)||i.push(n),o.index=i}if(o.sort){var s=o.sort.find((e=>{return t=e,Object.keys(t)[0]===n;var t}));s||(o.sort=o.sort.slice(0),o.sort.push({[n]:"asc"}))}else if(o.index)o.sort=o.index.map((e=>({[e]:"asc"})));else{if(e.indexes){var a=new Set;Object.entries(o.selector).forEach((([e,t])=>{("object"!=typeof t||null===t||Object.keys(t).find((e=>A.has(e))))&&a.add(e)}));var c,u=-1;e.indexes.forEach((e=>{var t,n=(t=e,Array.isArray(t)?e:[e]),r=n.findIndex((e=>!a.has(e)));r>0&&r>u&&(u=r,c=n)})),c&&(o.sort=c.map((e=>({[e]:"asc"}))))}o.sort||(o.sort=[{[n]:"asc"}])}return o}function Gt(e,t){if(!t.sort)throw d("SNH",{query:t});var n,r=(n=t.selector,Jt||(qe(Re.PIPELINE,{$sort:et,$project:_t}),qe(Re.QUERY,{$and:Pt,$eq:Dt,$elemMatch:Ut,$exists:Vt,$gt:Mt,$gte:Ct,$in:Tt,$lt:Bt,$lte:Rt,$ne:Lt,$nin:Kt,$mod:qt,$nor:At,$not:$t,$or:Nt,$regex:Ft,$size:zt,$type:Wt}),Jt=!0),new Ze(n));return e=>r.test(e)}function Yt(e,t,n,r,o,i,s){for(var a,c=!!e.schema.attachments,u=[],l=[],f=[],h={id:function(e=10){for(var t="",n=0;n<e;n++)t+=p.charAt(Math.floor(26*Math.random()));return t}(10),events:[],checkpoint:null,context:o},m=h.events,v=[],y=[],b=[],g=n.size>0,w=r.length,x=function(){var e,o=r[O],h=o.document,p=o.previous,w=h[t],x=h._deleted,I=p&&p._deleted,E=void 0;if(g&&(E=n.get(w)),E){var _=E._rev;if(!p||p&&_!==p._rev){var j={isError:!0,status:409,documentId:w,writeRow:o,documentInDb:E};return f.push(j),1}var k=c?Qt(o):o;c&&(x?p&&Object.keys(p._attachments).forEach((e=>{y.push({documentId:w,attachmentId:e,digest:S(p)._attachments[e].digest})})):(Object.entries(h._attachments).find((([t,n])=>((p?p._attachments[t]:void 0)||n.data||(e={documentId:w,documentInDb:E,isError:!0,status:510,writeRow:o,attachmentId:t}),!0))),e||Object.entries(h._attachments).forEach((([e,t])=>{var n=p?p._attachments[e]:void 0;if(n){var r=k.document._attachments[e].digest;t.data&&n.digest!==r&&b.push({documentId:w,attachmentId:e,attachmentData:t,digest:t.digest})}else v.push({documentId:w,attachmentId:e,attachmentData:t,digest:t.digest})})))),e?f.push(e):(c?(l.push(Qt(k)),s&&s(h)):(l.push(k),s&&s(h)),a=k);var P=null,N=null,A=null;if(I&&!x)A="INSERT",P=c?Xt(h):h;else if(!p||I||x){if(!x)throw d("SNH",{args:{writeRow:o}});A="DELETE",P=S(h),N=p}else A="UPDATE",P=c?Xt(h):h,N=p;var $={documentId:w,documentData:P,previousDocumentData:N,operation:A};m.push($)}else{var D=!!x;if(c&&Object.entries(h._attachments).forEach((([t,n])=>{n.data?v.push({documentId:w,attachmentId:t,attachmentData:n,digest:n.digest}):(e={documentId:w,isError:!0,status:510,writeRow:o,attachmentId:t},f.push(e))})),e||(c?(u.push(Qt(o)),i&&i(h)):(u.push(o),i&&i(h)),a=o),!D){var M={documentId:w,operation:"INSERT",documentData:c?Xt(h):h,previousDocumentData:c&&p?Xt(p):p};m.push(M)}}},O=0;O<w;O++)x();return{bulkInsertDocs:u,bulkUpdateDocs:l,newestRow:a,errors:f,eventBulk:h,attachmentsAdd:v,attachmentsRemove:y,attachmentsUpdate:b}}function Qt(e){return{previous:e.previous,document:Xt(e.document)}}function Xt(e){if(!e._attachments||0===Object.keys(e._attachments).length)return e;var t=I(e);return t._attachments={},Object.entries(e._attachments).forEach((([e,n])=>{var r,o,i;t._attachments[e]=(i=(r=n).data)?{length:(o=i,atob(o).length),digest:r.digest,type:r.type}:r})),t}async function Zt(e,t,n){if(e.getChangedDocumentsSince)return e.getChangedDocumentsSince(t,n);var r=x(e.schema.primaryKey),o=function(e,t){if(!t.sort)throw d("SNH",{query:t});return{query:t,queryPlan:N(e,t)}}(e.schema,function(e,t,n){var r=x(e.schema.primaryKey),o=n?n.lwt:1,i=n?n.id:"";return Ht(e.schema,{selector:{$or:[{"_meta.lwt":{$gt:o}},{"_meta.lwt":{$eq:o},[r]:{$gt:n?i:""}}],"_meta.lwt":{$gte:o}},sort:[{"_meta.lwt":"asc"},{[r]:"asc"}],skip:0,limit:t})}(e,t,n)),i=(await e.query(o)).documents,s=_(i);return{documents:i,checkpoint:s?{id:s[r],lwt:s._meta.lwt}:n||{id:"",lwt:0}}}new WeakMap,new WeakMap;var en="16.6.1",tn="16.6.1";function nn(e,t){var n=e.get(t);if(void 0===n)throw new Error("missing value from map "+t);return n}function rn(e,t,n,r){var o=e.get(t);return void 0===o?(o=n(),e.set(t,o)):r&&r(o),o}function on(e=0){return new Promise((t=>setTimeout(t,e)))}Promise.resolve(!0);var sn=Promise.resolve(!1),an=(Promise.resolve(null),Promise.resolve());function cn(e=1e4){return"function"==typeof requestIdleCallback?new Promise((t=>{requestIdleCallback((()=>t()),{timeout:e})})):on(0)}function un(e,t){var n=t.map((t=>{var n=w(e,t);if(!n)throw new Error("not in schema: "+t);var r,o=n.type;"number"!==o&&"integer"!==o||(r=ln(n));var i,s=O(t),a=n.maxLength?n.maxLength:0;return i="string"===o?e=>{var t=s(e);return t||(t=""),t.padEnd(a," ")}:"boolean"===o?e=>s(e)?"1":"0":e=>{var t=s(e);return fn(r,t)},{fieldName:t,schemaPart:n,parsedLengths:r,getValue:s,getIndexStringPart:i}}));return n}function ln(e){var t=Math.floor(e.minimum),n=Math.ceil(e.maximum),r=e.multipleOf,o=(n-t).toString().length,i=r.toString().split("."),s=0;return i.length>1&&(s=i[1].length),{minimum:t,maximum:n,nonDecimals:o,decimals:s,roundedMinimum:t}}function fn(e,t){void 0===t&&(t=0),t<e.minimum&&(t=e.minimum),t>e.maximum&&(t=e.maximum);var n=(Math.floor(t)-e.roundedMinimum).toString().padStart(e.nonDecimals,"0");if(e.decimals>0){var r=t.toString().split(".");n+=(r.length>1?r[1]:"0").padEnd(e.decimals,"0")}return n}function dn(e,t,n){var r="";return t.forEach(((t,o)=>{var i=w(e,t),s=n[o],a=i.type;switch(a){case"string":var c=S(i.maxLength,"maxLength not set");r+="string"==typeof s?s.padEnd(c," "):"".padEnd(c," ");break;case"boolean":r+=null===s||s===P?"0":s===k||s?"1":"0";break;case"number":case"integer":var u=ln(i);if(null===s||s===P)r+="0".repeat(u.nonDecimals+u.decimals);else if(s===k)r+=fn(u,u.maximum);else{var l=fn(u,s);r+=l}break;default:throw new Error("unknown index type "+a)}})),r}function hn(e,t,n){var r="";return t.forEach(((t,o)=>{var i=w(e,t),s=n[o],a=i.type;switch(a){case"string":var c=S(i.maxLength,"maxLength not set");r+="string"==typeof s&&s!==k?s.padEnd(c," "):"".padEnd(c,s===P?" ":k);break;case"boolean":r+=null===s||s?"1":"0";break;case"number":case"integer":var u=ln(i);r+=null===s||s===k?"9".repeat(u.nonDecimals+u.decimals):s===P?"0".repeat(u.nonDecimals+u.decimals):fn(u,s);break;default:throw new Error("unknown index type "+a)}})),r}function pn(e){return e.join("||")}var mn=["_deleted","_meta.lwt"];function vn(e,t){var n=pn(t);return nn(e.indexIdByName,n)}pn(mn);var yn={locale:null,unique:!1};function bn(e,t,n,r){for(var o={i:n,d:r,i0:void 0,i1:void 0,i2:void 0,i3:void 0,i4:void 0,i5:void 0,i6:void 0,i7:void 0},i=0;i<e;++i){var s=(0,t[i])(r);o["i"+i]=s}return o}function gn(e){var t={},n=e.indexes?e.indexes.map((e=>Array.isArray(e)?e.slice(0):[e])):[];n.push(mn);var r=new Map;return n.forEach(((n,o)=>{var i="i"+o,s=pn(n);if(r.has(s))throw new Error("duplicate index "+s);r.set(s,i),t[i]=function(e,t){var n=un(e,t),r=n.length,o=n.map((e=>e.getIndexStringPart));return function(e){for(var t="",n=0;n<r;++n)t+=o[n](e);return t}}(e,n)})),{indexIdByName:r,monadByIndexId:t}}var wn={durability:"relaxed"},xn="indexeddb",Sn=0;function On(e,t){return e+"||"+t}var In=new Map;function En(e,t){var n=rn(In,e,(()=>an));return n=S(n).then((()=>t())),In.set(e,n),n}function _n(e,t){t.onversionchange=n=>{e.closed||(t.close(),e.creationPromise=e.refreshIDBDatabase())}}async function jn(e,t,n,r){var o=await rn(e.indexedDBStates,n.databaseName,(()=>async function(e,t,n){var r=Sn++,o=await function(e,t){return"function"==typeof t?t(e):t}(e,n.indexedDB),i=async()=>(await on(0),En(e.databaseName,(()=>new Promise(((t,n)=>{var i=o.open(e.databaseName);i.onerror=function(t){console.error(r+": OPEN IDB DATABASE "+e.databaseName+" ERROR"),n(t)},i.onsuccess=function(e){var n=i.result;t(n),_n(s,n)},Nn(s,i)}))))),s={indexedDB:o,debugId:r,closed:!1,storage:t,settings:n,refreshIDBDatabase:i,creationPromise:i(),name:e.databaseName,refCount:0,storesToOpen:[]};return s}(n,e,t)));return o.storesToOpen=o.storesToOpen.concat(r),o.refCount=o.refCount+1,o.creationPromise.then((()=>kn(S(o)))).then((()=>S(o)))}async function kn(e){if(0!==e.storesToOpen.length)return e.creationPromise=e.creationPromise.then((async t=>{var n=new Set(Array.from(t.objectStoreNames));if(0===e.storesToOpen.filter((e=>!n.has(Pn(e.collectionName,e.schema).documentStore))).length)return t;var r=t.version+1;return t.close(),En(e.name,(()=>new Promise(((t,n)=>{var o=e.indexedDB.open(e.name,r);o.onerror=function(t){console.error(e.debugId+": ERROR openStoresOnExistingDatabase() openRequest: error "),n(t)},o.onsuccess=function(n){var r=o.result;_n(e,r),t(r)},o.onblocked=e=>{},Nn(e,o)}))))})),e.creationPromise}function Pn(e,t){var n=t.version;return{documentStore:e+"-"+n+"-documents",writeAheadStore:e+"-"+n+"-wal",attachmentsStore:e+"-"+n+"-attachments"}}function Nn(e,t){t.onupgradeneeded=function(n){var r=t.result;e.storesToOpen.forEach((e=>{var t=r.objectStoreNames,n=Pn(e.collectionName,e.schema);if(!t.contains(n.documentStore)){var o=r.createObjectStore(n.documentStore,{keyPath:"i",autoIncrement:!1});r.createObjectStore(n.writeAheadStore,{keyPath:"i",autoIncrement:!1}),function(e,t){t.indexIds.forEach((t=>{e.createIndex(t,t,yn)}))}(o,e),e.schema.attachments&&r.createObjectStore(n.attachmentsStore,{keyPath:"docIdWithAttachmentId",autoIncrement:!1})}})),e.storesToOpen=[]}}function An(e){if(e.closed)throw new Error("RxStorageInstanceIndexedDB is closed "+e.databaseName+"-"+e.collectionName)}async function $n(e,t){var n=e.primaryPath,r=e.internals.indexIds.length,o=e.internals.getIndexableStringByIndexNumber,i=t.objectStore(e.internals.storeNames.writeAheadStore),s=await new Promise(((e,t)=>{var n=i.get("documents");n.onerror=t,n.onsuccess=t=>{var r=n.result;e(r?JSON.parse(r.docsData):void 0)}}));if(s&&s.length>0){for(var a,c=t.objectStore(e.internals.storeNames.documentStore),u=0;u<s.length;++u){var l=s[u],f=bn(r,o,l[n],l);a=c.put(f)}await new Promise(((e,t)=>{a.onerror=t,a.onsuccess=()=>e(!0)})),i.delete("documents")}return t}async function Dn(e){var t,n=[e.internals.storeNames.documentStore,e.internals.storeNames.writeAheadStore];e.schema.attachments&&n.push(e.internals.storeNames.attachmentsStore);for(var r=100;r>0;){var o=await e.internals.state.creationPromise;r-=1;try{t=o.transaction(n,"readwrite",wn);break}catch(t){if("InvalidStateError"!==t.name&&"NotFoundError"!==t.name||!(r>0))throw t;"NotFoundError"===t.name?await kn(e.internals.state):e.internals.state.creationPromise=e.internals.state.refreshIDBDatabase()}}return await $n(e,S(t)),S(t)}var Mn=function(){function e(e){this.allTasksRuns=[],this.instance=e,this.txPromise=Dn(this.instance).then((t=>$n(e,t)))}return e.prototype.addTask=function(e){var t=this.txPromise.then((t=>e(t))),n=t.catch((()=>null));this.allTasksRuns.push(n);var r=this.allTasksRuns.length;return n.then((()=>Promise.all(this.allTasksRuns))).then((()=>{this.allTasksRuns.length===r&&(this.instance.openReadonlyTransaction=void 0)})),t.catch((t=>{if("TransactionInactiveError"===t.name)return this.instance.openReadonlyTransaction=void 0,Cn(this.instance,e);throw t}))},e}();function Cn(e,t){return e.openReadonlyTransaction||(e.openReadonlyTransaction=new Mn(e)),e.openReadonlyTransaction.addTask(t)}var Tn=0;function Bn(){var e=Date.now();(e+=.01)<=Tn&&(e=Tn+.01);var t=parseFloat(e.toFixed(2));return Tn=t,t}var Rn=function(e,t){return Rn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},Rn(e,t)};function Ln(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}Rn(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function Kn(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))}function qn(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}function Fn(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Un(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s}function zn(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))}function Vn(e){return this instanceof Vn?(this.v=e,this):new Vn(e)}function Wn(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,o=n.apply(e,t||[]),i=[];return r=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),s("next"),s("throw"),s("return",(function(e){return function(t){return Promise.resolve(t).then(e,u)}})),r[Symbol.asyncIterator]=function(){return this},r;function s(e,t){o[e]&&(r[e]=function(t){return new Promise((function(n,r){i.push([e,t,n,r])>1||a(e,t)}))},t&&(r[e]=t(r[e])))}function a(e,t){try{(n=o[e](t)).value instanceof Vn?Promise.resolve(n.value.v).then(c,u):l(i[0][2],n)}catch(e){l(i[0][3],e)}var n}function c(e){a("next",e)}function u(e){a("throw",e)}function l(e,t){e(t),i.shift(),i.length&&a(i[0][0],i[0][1])}}function Jn(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=Fn(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,o){!function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)}(r,o,(t=e[n](t)).done,t.value)}))}}}function Hn(e){return"function"==typeof e}function Gn(e){var t=e((function(e){Error.call(e),e.stack=(new Error).stack}));return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;var Yn=Gn((function(e){return function(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}}));function Qn(e,t){if(e){var n=e.indexOf(t);0<=n&&e.splice(n,1)}}var Xn=function(){function e(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}var t;return e.prototype.unsubscribe=function(){var e,t,n,r,o;if(!this.closed){this.closed=!0;var i=this._parentage;if(i)if(this._parentage=null,Array.isArray(i))try{for(var s=Fn(i),a=s.next();!a.done;a=s.next())a.value.remove(this)}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}else i.remove(this);var c=this.initialTeardown;if(Hn(c))try{c()}catch(e){o=e instanceof Yn?e.errors:[e]}var u=this._finalizers;if(u){this._finalizers=null;try{for(var l=Fn(u),f=l.next();!f.done;f=l.next()){var d=f.value;try{tr(d)}catch(e){o=null!=o?o:[],e instanceof Yn?o=zn(zn([],Un(o)),Un(e.errors)):o.push(e)}}}catch(e){n={error:e}}finally{try{f&&!f.done&&(r=l.return)&&r.call(l)}finally{if(n)throw n.error}}}if(o)throw new Yn(o)}},e.prototype.add=function(t){var n;if(t&&t!==this)if(this.closed)tr(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(t)}},e.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},e.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},e.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&Qn(t,e)},e.prototype.remove=function(t){var n=this._finalizers;n&&Qn(n,t),t instanceof e&&t._removeParent(this)},e.EMPTY=((t=new e).closed=!0,t),e}(),Zn=Xn.EMPTY;function er(e){return e instanceof Xn||e&&"closed"in e&&Hn(e.remove)&&Hn(e.add)&&Hn(e.unsubscribe)}function tr(e){Hn(e)?e():e.unsubscribe()}var nr={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},rr={setTimeout:function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var o=rr.delegate;return(null==o?void 0:o.setTimeout)?o.setTimeout.apply(o,zn([e,t],Un(n))):setTimeout.apply(void 0,zn([e,t],Un(n)))},clearTimeout:function(e){var t=rr.delegate;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function or(e){rr.setTimeout((function(){var t=nr.onUnhandledError;if(!t)throw e;t(e)}))}function ir(){}var sr=ar("C",void 0,void 0);function ar(e,t,n){return{kind:e,value:t,error:n}}var cr=null;function ur(e){if(nr.useDeprecatedSynchronousErrorHandling){var t=!cr;if(t&&(cr={errorThrown:!1,error:null}),e(),t){var n=cr,r=n.errorThrown,o=n.error;if(cr=null,r)throw o}}else e()}var lr=function(e){function t(t){var n=e.call(this)||this;return n.isStopped=!1,t?(n.destination=t,er(t)&&t.add(n)):n.destination=yr,n}return Ln(t,e),t.create=function(e,t,n){return new pr(e,t,n)},t.prototype.next=function(e){this.isStopped?vr(function(e){return ar("N",e,void 0)}(e),this):this._next(e)},t.prototype.error=function(e){this.isStopped?vr(ar("E",void 0,e),this):(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped?vr(sr,this):(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(Xn),fr=Function.prototype.bind;function dr(e,t){return fr.call(e,t)}var hr=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(e){mr(e)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(e){mr(e)}else mr(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(e){mr(e)}},e}(),pr=function(e){function t(t,n,r){var o,i,s=e.call(this)||this;return Hn(t)||!t?o={next:null!=t?t:void 0,error:null!=n?n:void 0,complete:null!=r?r:void 0}:s&&nr.useDeprecatedNextContext?((i=Object.create(t)).unsubscribe=function(){return s.unsubscribe()},o={next:t.next&&dr(t.next,i),error:t.error&&dr(t.error,i),complete:t.complete&&dr(t.complete,i)}):o=t,s.destination=new hr(o),s}return Ln(t,e),t}(lr);function mr(e){var t;nr.useDeprecatedSynchronousErrorHandling?(t=e,nr.useDeprecatedSynchronousErrorHandling&&cr&&(cr.errorThrown=!0,cr.error=t)):or(e)}function vr(e,t){var n=nr.onStoppedNotification;n&&rr.setTimeout((function(){return n(e,t)}))}var yr={closed:!0,next:ir,error:function(e){throw e},complete:ir},br="function"==typeof Symbol&&Symbol.observable||"@@observable";function gr(e){return e}function wr(e){return 0===e.length?gr:1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)}}var xr=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var r,o=this,i=(r=e)&&r instanceof lr||function(e){return e&&Hn(e.next)&&Hn(e.error)&&Hn(e.complete)}(r)&&er(r)?e:new pr(e,t,n);return ur((function(){var e=o,t=e.operator,n=e.source;i.add(t?t.call(i,n):n?o._subscribe(i):o._trySubscribe(i))})),i},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=Sr(t))((function(t,r){var o=new pr({next:function(t){try{e(t)}catch(e){r(e),o.unsubscribe()}},error:r,complete:t});n.subscribe(o)}))},e.prototype._subscribe=function(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)},e.prototype[br]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return wr(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=Sr(e))((function(e,n){var r;t.subscribe((function(e){return r=e}),(function(e){return n(e)}),(function(){return e(r)}))}))},e.create=function(t){return new e(t)},e}();function Sr(e){var t;return null!==(t=null!=e?e:nr.Promise)&&void 0!==t?t:Promise}var Or=Gn((function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}})),Ir=function(e){function t(){var t=e.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return Ln(t,e),t.prototype.lift=function(e){var t=new Er(this,this);return t.operator=e,t},t.prototype._throwIfClosed=function(){if(this.closed)throw new Or},t.prototype.next=function(e){var t=this;ur((function(){var n,r;if(t._throwIfClosed(),!t.isStopped){t.currentObservers||(t.currentObservers=Array.from(t.observers));try{for(var o=Fn(t.currentObservers),i=o.next();!i.done;i=o.next())i.value.next(e)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}}}))},t.prototype.error=function(e){var t=this;ur((function(){if(t._throwIfClosed(),!t.isStopped){t.hasError=t.isStopped=!0,t.thrownError=e;for(var n=t.observers;n.length;)n.shift().error(e)}}))},t.prototype.complete=function(){var e=this;ur((function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var t=e.observers;t.length;)t.shift().complete()}}))},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(t){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var t=this,n=this,r=n.hasError,o=n.isStopped,i=n.observers;return r||o?Zn:(this.currentObservers=null,i.push(e),new Xn((function(){t.currentObservers=null,Qn(i,e)})))},t.prototype._checkFinalizedStatuses=function(e){var t=this,n=t.hasError,r=t.thrownError,o=t.isStopped;n?e.error(r):o&&e.complete()},t.prototype.asObservable=function(){var e=new xr;return e.source=this,e},t.create=function(e,t){return new Er(e,t)},t}(xr),Er=function(e){function t(t,n){var r=e.call(this)||this;return r.destination=t,r.source=n,r}return Ln(t,e),t.prototype.next=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===n||n.call(t,e)},t.prototype.error=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===n||n.call(t,e)},t.prototype.complete=function(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)},t.prototype._subscribe=function(e){var t,n;return null!==(n=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==n?n:Zn},t}(Ir);function _r(e){return function(t){if(function(e){return Hn(null==e?void 0:e.lift)}(t))return t.lift((function(t){try{return e(t,this)}catch(e){this.error(e)}}));throw new TypeError("Unable to lift unknown Observable type")}}var jr=Array.isArray;function kr(e,t,n,r,o){return new Pr(e,t,n,r,o)}var Pr=function(e){function t(t,n,r,o,i,s){var a=e.call(this,t)||this;return a.onFinalize=i,a.shouldUnsubscribe=s,a._next=n?function(e){try{n(e)}catch(e){t.error(e)}}:e.prototype._next,a._error=o?function(e){try{o(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,a._complete=r?function(){try{r()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,a}return Ln(t,e),t.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;e.prototype.unsubscribe.call(this),!n&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}},t}(lr),Nr=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function Ar(e){return Hn(null==e?void 0:e.then)}function $r(e){return Hn(e[br])}function Dr(e){return Symbol.asyncIterator&&Hn(null==e?void 0:e[Symbol.asyncIterator])}function Mr(e){return new TypeError("You provided "+(null!==e&&"object"==typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}var Cr="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function Tr(e){return Hn(null==e?void 0:e[Cr])}function Br(e){return Wn(this,arguments,(function(){var t,n,r;return qn(this,(function(o){switch(o.label){case 0:t=e.getReader(),o.label=1;case 1:o.trys.push([1,,9,10]),o.label=2;case 2:return[4,Vn(t.read())];case 3:return n=o.sent(),r=n.value,n.done?[4,Vn(void 0)]:[3,5];case 4:return[2,o.sent()];case 5:return[4,Vn(r)];case 6:return[4,o.sent()];case 7:return o.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}}))}))}function Rr(e){return Hn(null==e?void 0:e.getReader)}function Lr(e){if(e instanceof xr)return e;if(null!=e){if($r(e))return o=e,new xr((function(e){var t=o[br]();if(Hn(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")}));if(Nr(e))return r=e,new xr((function(e){for(var t=0;t<r.length&&!e.closed;t++)e.next(r[t]);e.complete()}));if(Ar(e))return n=e,new xr((function(e){n.then((function(t){e.closed||(e.next(t),e.complete())}),(function(t){return e.error(t)})).then(null,or)}));if(Dr(e))return Kr(e);if(Tr(e))return t=e,new xr((function(e){var n,r;try{for(var o=Fn(t),i=o.next();!i.done;i=o.next()){var s=i.value;if(e.next(s),e.closed)return}}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}e.complete()}));if(Rr(e))return Kr(Br(e))}var t,n,r,o;throw Mr(e)}function Kr(e){return new xr((function(t){(function(e,t){var n,r,o,i;return Kn(this,void 0,void 0,(function(){var s,a;return qn(this,(function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),n=Jn(e),c.label=1;case 1:return[4,n.next()];case 2:if((r=c.sent()).done)return[3,4];if(s=r.value,t.next(s),t.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=c.sent(),o={error:a},[3,11];case 6:return c.trys.push([6,,9,10]),r&&!r.done&&(i=n.return)?[4,i.call(n)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(o)throw o.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}}))}))})(e,t).catch((function(e){return t.error(e)}))}))}function qr(e,t,n,r,o){void 0===r&&(r=0),void 0===o&&(o=!1);var i=t.schedule((function(){n(),o?e.add(this.schedule(null,r)):this.unsubscribe()}),r);if(e.add(i),!o)return i}function Fr(e,t,n){return void 0===n&&(n=1/0),Hn(t)?Fr((function(n,r){return function(e,t){return _r((function(n,r){var o=0;n.subscribe(kr(r,(function(n){r.next(e.call(t,n,o++))})))}))}((function(e,o){return t(n,e,r,o)}))(Lr(e(n,r)))}),n):("number"==typeof t&&(n=t),_r((function(t,r){return function(e,t,n,r,o,i,s,a){var c=[],u=0,l=0,f=!1,d=function(){!f||c.length||u||t.complete()},h=function(e){return u<r?p(e):c.push(e)},p=function(e){i&&t.next(e),u++;var a=!1;Lr(n(e,l++)).subscribe(kr(t,(function(e){null==o||o(e),i?h(e):t.next(e)}),(function(){a=!0}),void 0,(function(){if(a)try{u--;for(var e=function(){var e=c.shift();s?qr(t,s,(function(){return p(e)})):p(e)};c.length&&u<r;)e();d()}catch(e){t.error(e)}})))};return e.subscribe(kr(t,h,(function(){f=!0,d()}))),function(){null==a||a()}}(t,r,e,n)})))}function Ur(e){return e[e.length-1]}function zr(e){return(t=Ur(e))&&Hn(t.schedule)?e.pop():void 0;var t}function Vr(e,t){return void 0===t&&(t=0),_r((function(n,r){n.subscribe(kr(r,(function(n){return qr(r,e,(function(){return r.next(n)}),t)}),(function(){return qr(r,e,(function(){return r.complete()}),t)}),(function(n){return qr(r,e,(function(){return r.error(n)}),t)})))}))}function Wr(e,t){return void 0===t&&(t=0),_r((function(n,r){r.add(e.schedule((function(){return n.subscribe(r)}),t))}))}function Jr(e,t){if(!e)throw new Error("Iterable cannot be null");return new xr((function(n){qr(n,t,(function(){var r=e[Symbol.asyncIterator]();qr(n,t,(function(){r.next().then((function(e){e.done?n.complete():n.next(e.value)}))}),0,!0)}))}))}function Hr(e,t){if(null!=e){if($r(e))return function(e,t){return Lr(e).pipe(Wr(t),Vr(t))}(e,t);if(Nr(e))return function(e,t){return new xr((function(n){var r=0;return t.schedule((function(){r===e.length?n.complete():(n.next(e[r++]),n.closed||this.schedule())}))}))}(e,t);if(Ar(e))return function(e,t){return Lr(e).pipe(Wr(t),Vr(t))}(e,t);if(Dr(e))return Jr(e,t);if(Tr(e))return function(e,t){return new xr((function(n){var r;return qr(n,t,(function(){r=e[Cr](),qr(n,t,(function(){var e,t,o;try{t=(e=r.next()).value,o=e.done}catch(e){return void n.error(e)}o?n.complete():n.next(t)}),0,!0)})),function(){return Hn(null==r?void 0:r.return)&&r.return()}}))}(e,t);if(Rr(e))return function(e,t){return Jr(Br(e),t)}(e,t)}throw Mr(e)}function Gr(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=zr(e),r=function(e,t){return"number"==typeof Ur(e)?e.pop():t}(e,1/0);return e=function(e){return 1===e.length&&jr(e[0])?e[0]:e}(e),_r((function(t,o){(function(e){return void 0===e&&(e=1/0),Fr(gr,e)})(r)(function(e,t){return t?Hr(e,t):Lr(e)}(zn([t],Un(e)),n)).subscribe(o)}))}Promise.resolve(!1),Promise.resolve(!0);var Yr=Promise.resolve();function Qr(e,t){return e||(e=0),new Promise((function(n){return setTimeout((function(){return n(t)}),e)}))}function Xr(){return Math.random().toString(36).substring(2)}var Zr=0;function eo(){var e=1e3*Date.now();return e<=Zr&&(e=Zr+1),Zr=e,e}var to={create:function(e){var t={time:eo(),messagesCallback:null,bc:new BroadcastChannel(e),subFns:[]};return t.bc.onmessage=function(e){t.messagesCallback&&t.messagesCallback(e.data)},t},close:function(e){e.bc.close(),e.subFns=[]},onMessage:function(e,t){e.messagesCallback=t},postMessage:function(e,t){try{return e.bc.postMessage(t,!1),Yr}catch(e){return Promise.reject(e)}},canBeUsed:function(){if("undefined"!=typeof globalThis&&globalThis.Deno&&globalThis.Deno.args)return!0;if("undefined"==typeof window&&"undefined"==typeof self||"function"!=typeof BroadcastChannel)return!1;if(BroadcastChannel._pubkey)throw new Error("BroadcastChannel: Do not overwrite window.BroadcastChannel with this module, this is not a polyfill");return!0},type:"native",averageResponseTime:function(){return 150},microSeconds:eo};class no{ttl;map=new Map;_to=!1;constructor(e){this.ttl=e}has(e){return this.map.has(e)}add(e){this.map.set(e,ro()),this._to||(this._to=!0,setTimeout((()=>{this._to=!1,function(e){const t=ro()-e.ttl,n=e.map[Symbol.iterator]();for(;;){const r=n.next().value;if(!r)return;const o=r[0];if(!(r[1]<t))return;e.map.delete(o)}}(this)}),0))}clear(){this.map.clear()}}function ro(){return Date.now()}function oo(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=JSON.parse(JSON.stringify(e));return void 0===t.webWorkerSupport&&(t.webWorkerSupport=!0),t.idb||(t.idb={}),t.idb.ttl||(t.idb.ttl=45e3),t.idb.fallbackInterval||(t.idb.fallbackInterval=150),e.idb&&"function"==typeof e.idb.onclose&&(t.idb.onclose=e.idb.onclose),t.localstorage||(t.localstorage={}),t.localstorage.removeTimeout||(t.localstorage.removeTimeout=6e4),e.methods&&(t.methods=e.methods),t.node||(t.node={}),t.node.ttl||(t.node.ttl=12e4),t.node.maxParallelWrites||(t.node.maxParallelWrites=2048),void 0===t.node.useFastPath&&(t.node.useFastPath=!0),t}var io="messages",so={durability:"relaxed"};function ao(){if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof window){if(void 0!==window.mozIndexedDB)return window.mozIndexedDB;if(void 0!==window.webkitIndexedDB)return window.webkitIndexedDB;if(void 0!==window.msIndexedDB)return window.msIndexedDB}return!1}function co(e){e.commit&&e.commit()}function uo(e,t){var n=e.transaction(io,"readonly",so),r=n.objectStore(io),o=[],i=IDBKeyRange.bound(t+1,1/0);if(r.getAll){var s=r.getAll(i);return new Promise((function(e,t){s.onerror=function(e){return t(e)},s.onsuccess=function(t){e(t.target.result)}}))}return new Promise((function(e,s){var a=function(){try{return i=IDBKeyRange.bound(t+1,1/0),r.openCursor(i)}catch(e){return r.openCursor()}}();a.onerror=function(e){return s(e)},a.onsuccess=function(r){var i=r.target.result;i?i.value.id<t+1?i.continue(t+1):(o.push(i.value),i.continue()):(co(n),e(o))}}))}function lo(e){return(t=e.db,n=e.options.idb.ttl,r=Date.now()-n,o=t.transaction(io,"readonly",so),i=o.objectStore(io),s=[],new Promise((function(e){i.openCursor().onsuccess=function(t){var n=t.target.result;if(n){var i=n.value;i.time<r?(s.push(i),n.continue()):(co(o),e(s))}else e(s)}}))).then((function(t){return function(e,t){if(e.closed)return Promise.resolve([]);var n=e.db.transaction(io,"readwrite",so).objectStore(io);return Promise.all(t.map((function(e){var t=n.delete(e);return new Promise((function(e){t.onsuccess=function(){return e()}}))})))}(e,t.map((function(e){return e.id})))}));var t,n,r,o,i,s}function fo(e){e.closed||ho(e).then((function(){return Qr(e.options.idb.fallbackInterval)})).then((function(){return fo(e)}))}function ho(e){return e.closed?Yr:e.messagesCallback?uo(e.db,e.lastCursorId).then((function(t){var n=t.filter((function(e){return!!e})).map((function(t){return t.id>e.lastCursorId&&(e.lastCursorId=t.id),t})).filter((function(t){return function(e,t){return!(e.uuid===t.uuid||t.eMIs.has(e.id)||e.data.time<t.messagesCallbackTime)}(t,e)})).sort((function(e,t){return e.time-t.time}));return n.forEach((function(t){e.messagesCallback&&(e.eMIs.add(t.id),e.messagesCallback(t.data))})),Yr})):Yr}var po={create:function(e,t){return t=oo(t),function(e){var t="pubkey.broadcast-channel-0-"+e,n=ao().open(t);return n.onupgradeneeded=function(e){e.target.result.createObjectStore(io,{keyPath:"id",autoIncrement:!0})},new Promise((function(e,t){n.onerror=function(e){return t(e)},n.onsuccess=function(){e(n.result)}}))}(e).then((function(n){var r={closed:!1,lastCursorId:0,channelName:e,options:t,uuid:Xr(),eMIs:new no(2*t.idb.ttl),writeBlockPromise:Yr,messagesCallback:null,readQueuePromises:[],db:n};return n.onclose=function(){r.closed=!0,t.idb.onclose&&t.idb.onclose()},fo(r),r}))},close:function(e){e.closed=!0,e.db.close()},onMessage:function(e,t,n){e.messagesCallbackTime=n,e.messagesCallback=t,ho(e)},postMessage:function(e,t){return e.writeBlockPromise=e.writeBlockPromise.then((function(){return function(e,t,n){var r={uuid:t,time:Date.now(),data:n},o=e.transaction([io],"readwrite",so);return new Promise((function(e,t){o.oncomplete=function(){return e()},o.onerror=function(e){return t(e)},o.objectStore(io).add(r),co(o)}))}(e.db,e.uuid,t)})).then((function(){var t,n;0===(t=0,n=10,Math.floor(Math.random()*(n-t+1)+t))&&lo(e)})),e.writeBlockPromise},canBeUsed:function(){return!!ao()},type:"idb",averageResponseTime:function(e){return 2*e.idb.fallbackInterval},microSeconds:eo};function mo(){var e;if("undefined"==typeof window)return null;try{e=window.localStorage,e=window["ie8-eventlistener/storage"]||window.localStorage}catch(e){}return e}function vo(e){return"pubkey.broadcastChannel-"+e}function yo(){var e=mo();if(!e)return!1;try{var t="__broadcastchannel_check";e.setItem(t,"works"),e.removeItem(t)}catch(e){return!1}return!0}var bo,go={create:function(e,t){if(t=oo(t),!yo())throw new Error("BroadcastChannel: localstorage cannot be used");var n=Xr(),r=new no(t.localstorage.removeTimeout),o={channelName:e,uuid:n,eMIs:r};return o.listener=function(e,t){var n=vo(e),r=function(e){e.key===n&&t(JSON.parse(e.newValue))};return window.addEventListener("storage",r),r}(e,(function(e){o.messagesCallback&&e.uuid!==n&&e.token&&!r.has(e.token)&&(e.data.time&&e.data.time<o.messagesCallbackTime||(r.add(e.token),o.messagesCallback(e.data)))})),o},close:function(e){var t;t=e.listener,window.removeEventListener("storage",t)},onMessage:function(e,t,n){e.messagesCallbackTime=n,e.messagesCallback=t},postMessage:function(e,t){return new Promise((function(n){Qr().then((function(){var r=vo(e.channelName),o={token:Xr(),time:Date.now(),data:t,uuid:e.uuid},i=JSON.stringify(o);mo().setItem(r,i);var s=document.createEvent("Event");s.initEvent("storage",!0,!0),s.key=r,s.newValue=i,window.dispatchEvent(s),n()}))}))},canBeUsed:yo,type:"localstorage",averageResponseTime:function(){var e=navigator.userAgent.toLowerCase();return e.includes("safari")&&!e.includes("chrome")?240:120},microSeconds:eo},wo=eo,xo=new Set,So={create:function(e){var t={time:wo(),name:e,messagesCallback:null};return xo.add(t),t},close:function(e){xo.delete(e)},onMessage:function(e,t){e.messagesCallback=t},postMessage:function(e,t){return new Promise((function(n){return setTimeout((function(){Array.from(xo).forEach((function(n){n.name===e.name&&n!==e&&n.messagesCallback&&n.time<t.time&&n.messagesCallback(t)})),n()}),5)}))},canBeUsed:function(){return!0},type:"simulate",averageResponseTime:function(){return 5},microSeconds:wo},Oo=[to,po,go],Io=new Set,Eo=0,_o=function(e,t){var n,r,o;this.id=Eo++,Io.add(this),this.name=e,bo&&(t=bo),this.options=oo(t),this.method=function(e){var t=[].concat(e.methods,Oo).filter(Boolean);if(e.type){if("simulate"===e.type)return So;var n=t.find((function(t){return t.type===e.type}));if(n)return n;throw new Error("method-type "+e.type+" not found")}e.webWorkerSupport||(t=t.filter((function(e){return"idb"!==e.type})));var r=t.find((function(e){return e.canBeUsed()}));if(r)return r;throw new Error("No usable method found in "+JSON.stringify(Oo.map((function(e){return e.type}))))}(this.options),this._iL=!1,this._onML=null,this._addEL={message:[],internal:[]},this._uMP=new Set,this._befC=[],this._prepP=null,(o=r=(n=this).method.create(n.name,n.options))&&"function"==typeof o.then?(n._prepP=r,r.then((function(e){n._state=e}))):n._state=r};function jo(e,t,n){var r={time:e.method.microSeconds(),type:t,data:n};return(e._prepP?e._prepP:Yr).then((function(){var t=e.method.postMessage(e._state,r);return e._uMP.add(t),t.catch().then((function(){return e._uMP.delete(t)})),t}))}function ko(e){return e._addEL.message.length>0||e._addEL.internal.length>0}function Po(e,t,n){e._addEL[t].push(n),function(e){if(!e._iL&&ko(e)){var t=function(t){e._addEL[t.type].forEach((function(e){t.time>=e.time&&e.fn(t.data)}))},n=e.method.microSeconds();e._prepP?e._prepP.then((function(){e._iL=!0,e.method.onMessage(e._state,t,n)})):(e._iL=!0,e.method.onMessage(e._state,t,n))}}(e)}function No(e,t,n){e._addEL[t]=e._addEL[t].filter((function(e){return e!==n})),function(e){if(e._iL&&!ko(e)){e._iL=!1;var t=e.method.microSeconds();e.method.onMessage(e._state,null,t)}}(e)}_o._pubkey=!0,_o.prototype={postMessage:function(e){if(this.closed)throw new Error("BroadcastChannel.postMessage(): Cannot post message after channel has closed "+JSON.stringify(e));return jo(this,"message",e)},postInternal:function(e){return jo(this,"internal",e)},set onmessage(e){var t={time:this.method.microSeconds(),fn:e};No(this,"message",this._onML),e&&"function"==typeof e?(this._onML=t,Po(this,"message",t)):this._onML=null},addEventListener:function(e,t){Po(this,e,{time:this.method.microSeconds(),fn:t})},removeEventListener:function(e,t){No(this,e,this._addEL[e].find((function(e){return e.fn===t})))},close:function(){var e=this;if(!this.closed){Io.delete(this),this.closed=!0;var t=this._prepP?this._prepP:Yr;return this._onML=null,this._addEL.message=[],t.then((function(){return Promise.all(Array.from(e._uMP))})).then((function(){return Promise.all(e._befC.map((function(e){return e()})))})).then((function(){return e.method.close(e._state)}))}},get type(){return this.method.type},get isClosed(){return this.closed}};var Ao=new Map;function $o(e,t){var n=Ao.get(e);if(n)return n.refs.delete(t),0===n.refs.size?(Ao.delete(e),n.bc.close()):void 0}function Do(e,t,n,r){if(t.multiInstance){var o=r||function(e,t,n,r){var o=Ao.get(t);return o||(o={bc:new _o(["RxDB:",e,n].join("|")),refs:new Set},Ao.set(t,o)),o.refs.add(r),o.bc}(e,t.databaseInstanceToken,n.databaseName,n),i=new Ir,s=n=>{n.storageName===e&&n.databaseName===t.databaseName&&n.collectionName===t.collectionName&&n.version===t.schema.version&&i.next(n.eventBulk)};o.addEventListener("message",s);var a=n.changeStream(),c=!1,u=a.subscribe((n=>{c||o.postMessage({storageName:e,databaseName:t.databaseName,collectionName:t.collectionName,version:t.schema.version,eventBulk:n})}));n.changeStream=function(){return i.asObservable().pipe(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Gr.apply(void 0,zn([],Un(e)))}(a))};var l=n.close.bind(n);n.close=async function(){return c=!0,u.unsubscribe(),o.removeEventListener("message",s),r||await $o(t.databaseInstanceToken,n),l()};var f=n.remove.bind(n);n.remove=async function(){return c=!0,u.unsubscribe(),o.removeEventListener("message",s),r||await $o(t.databaseInstanceToken,n),f()}}}async function Mo(e,t){return Cn(e,(async n=>{var r=t.queryPlan,o=t.query,i=o.skip?o.skip:0,s=i+(o.limit?o.limit:1/0),a=e.internals.storeNames.documentStore,c=e.settings.batchSize?e.settings.batchSize:50,u=!1;r.selectorSatisfiedByIndex||(u=Gt(e.schema,o));var l=r.index,f=!r.sortSatisfiedByIndex,h=l,p=r.startKeys,m=dn(e.schema,h,p),v=r.endKeys,y=hn(e.schema,h,v),b=[],g=n.objectStore(a),w=vn(e.internals,h),x=g.index(w);u||t.query.limit||(c=1e5);var S=!1;if(await async function(e,t,n,r,o,i,s,a){var c=e.settings.IDBKeyRange?e.settings.IDBKeyRange:IDBKeyRange,u=e.internals.getIndexableStringByIndexId[s];if("function"==typeof n.getAll&&1!==r)for(var l,f=!0,d=!1,h=async function(){l&&(o=u(l.d));var e=c.bound(o,i,!f||!t.inclusiveStart,!t.inclusiveEnd);f=!1;var s=n.getAll(e,r);await new Promise(((e,t)=>{s.onerror=t,s.onsuccess=t=>{var n=t.target.result;l=_(n),0!==n.length&&!1===a(n)&&(d=!0),n.length<r&&(d=!0),e()}}))};!d;)await h();else{var p=c.bound(o,i,!t.inclusiveStart,!t.inclusiveEnd),m=n.openCursor(p);await new Promise((e=>{m.onsuccess=function(t){var n=t.target.result;if(n){var r=n.value;a([r])?n.continue():e()}else e()}}))}}(e,r,x,c,m,y,w,(e=>{for(var t=0;t<e.length;t++){var n=e[t].d;if(S||u&&!u(n)||b.push(n),!f&&b.length===s){S=!0;break}}return!S})),f){var I=function(e,t){if(!t.sort)throw d("SNH",{query:t});var n=[];return t.sort.forEach((e=>{var t=Object.keys(e)[0],r=Object.values(e)[0];n.push({key:t,direction:r,getValueFn:O(t)})})),(e,t)=>{for(var r=0;r<n.length;++r){var o=n[r],i=o.getValueFn(e),s=o.getValueFn(t);if(i!==s)return"asc"===o.direction?z(i,s):z(s,i)}}}(e.schema,o);b=b.sort(I)}return{documents:b=b.slice(i,s)}}))}async function Co(e,t,n){var r=e.primaryPath,o=e.internals,i=e.internals.state;await i.creationPromise;var s=[o.storeNames.documentStore,o.storeNames.writeAheadStore];e.schema.attachments&&s.push(o.storeNames.attachmentsStore),An(e);var a,c=await Dn(e),u=c.objectStore(o.storeNames.documentStore);a=0===e.internals.minKnownDocsAmount&&t.length>30&&!await function(e,t){var n=(e.settings.IDBKeyRange?e.settings.IDBKeyRange:IDBKeyRange).lowerBound(P,!0),r=t.getKey(n);return new Promise((e=>{r.onsuccess=()=>{e(!!r.result)}}))}(e,u)?new Map:await function(e,t,n){var r=n.length,o=new Map;if(0===r)return Promise.resolve(o);for(var i=new Array(r),s=0;s<r;s++){var a=n[s].document[e],c=t.get(a);i[s]=c}var u=S(_(i));return new Promise(((t,n)=>{u.onerror=n,u.onsuccess=()=>{for(var n=0;n<r;n++){var s=i[n].result;if(s){var a=s.d,c=a[e];o.set(c,a)}}t(o)}}))}(r,u,t);for(var l=Yt(e,r,a,t,n),f=l.errors,d=l.bulkInsertDocs,h=new Array(d.length),p=0;p<d.length;++p){var m=d[p].document;h[p]=m}for(var v,y=l.bulkUpdateDocs,b=0;b<y.length;++b){var g=y[b].document;h.push(g)}if(h.length>0){var w=c.objectStore(o.storeNames.writeAheadStore).put({i:"documents",docsData:JSON.stringify(h)});await new Promise(((e,t)=>{w.onerror=t,w.onsuccess=e})),e.handleWalIdlePromise||on(100).then((()=>cn())).then((async()=>{e.handleWalIdlePromise=void 0,e.closed||await Cn(e,(()=>sn))}))}if(e.schema.attachments){var x=c.objectStore(e.internals.storeNames.attachmentsStore);l.attachmentsAdd.forEach((e=>{v=x.put({docIdWithAttachmentId:On(e.documentId,e.attachmentId),length:e.attachmentData.length,type:e.attachmentData.type,data:e.attachmentData.data})})),l.attachmentsUpdate.forEach((e=>{v=x.put({docIdWithAttachmentId:On(e.documentId,e.attachmentId),length:e.attachmentData.length,type:e.attachmentData.type,data:e.attachmentData.data})})),l.attachmentsRemove.forEach((e=>{v=x.delete(On(e.documentId,e.attachmentId))}))}if(v&&await new Promise(((e,t)=>{S(v).onerror=t,S(v).onsuccess=e})),c.commit&&c.commit(),l.eventBulk.events.length>0){var O=S(l.newestRow).document;l.eventBulk.checkpoint={id:O[r],lwt:O._meta.lwt},e.changes$.next(l.eventBulk)}return{error:f}}var To=Bn(),Bo=function(){function e(e,t,n,r,o,i,s){this.changes$=new Ir,this.instanceId=To++,this.storage=e,this.databaseName=t,this.collectionName=n,this.schema=r,this.internals=o,this.options=i,this.settings=s,this.primaryPath=x(this.schema.primaryKey)}var t=e.prototype;return t.updateMinKnownDocs=function(e){this.internals.minKnownDocsAmount<e&&(this.internals.minKnownDocsAmount=e)},t.bulkWrite=async function(e,t){var n=await Co(this,e,t);return this.updateMinKnownDocs(e.length-n.error.length),n},t.findDocumentsById=async function(e,t){An(this);var n=await Cn(this,(async n=>function(e,t,n){var r=t.length;if(0===r)return Promise.resolve([]);for(var o=new Array(r),i=0;i<r;i++){var s=t[i];o[i]=e.get(s)}var a=[],c=S(_(o));return new Promise(((e,t)=>{c.onerror=t,c.onsuccess=()=>{for(var t=0;t<r;t++){var i=o[t].result;if(i){var s=i.d;!n&&s._deleted||a.push(s)}}e(a)}}))}(n.objectStore(this.internals.storeNames.documentStore),e,t)));return this.updateMinKnownDocs(n.length),n},t.query=async function(e){await this.internals.state.creationPromise,An(this);var t=await Mo(this,e);return this.updateMinKnownDocs(t.documents.length),t},t.count=async function(e){if(e.queryPlan.selectorSatisfiedByIndex){var t=await async function(e,t){return Cn(e,(async n=>{var r,o=t.queryPlan,i=e.internals.storeNames.documentStore,s=o.index,a=s,c=o.startKeys,u=dn(e.schema,a,c),l=o.endKeys,f=hn(e.schema,a,l),d=n.objectStore(i);r=1===s.length&&s[0]===e.primaryPath?vn(e.internals,["_deleted",e.primaryPath]):vn(e.internals,a);var h=d.index(r),p=(e.settings.IDBKeyRange?e.settings.IDBKeyRange:IDBKeyRange).bound(u,f,!o.inclusiveStart,!o.inclusiveEnd),m=h.count(p);return{count:await new Promise(((e,t)=>{m.onsuccess=function(){e(m.result)},m.onerror=t})),mode:"fast"}}))}(this,e);return this.updateMinKnownDocs(t.count),t}var n=await Mo(this,e);return this.updateMinKnownDocs(n.documents.length),{count:n.documents.length,mode:"slow"}},t.changeStream=function(){return this.changes$.asObservable()},t.cleanup=async function(e){await on(0),await on(0);var t=this.internals.state;await t.creationPromise;var n=this.settings.IDBKeyRange;An(this);var r=(await Dn(this)).objectStore(this.internals.storeNames.documentStore),o=this.settings.batchSize,i=Bn()-e,s=vn(this.internals,mn),a=r.index(s),c=dn(this.schema,mn,[!0,1]),u=hn(this.schema,mn,[!0,i]),l=n.bound(c,u,!0,!0),f=await new Promise(((e,t)=>{var n=a.getAll(l,o);n.onerror=t,n.onsuccess=function(t){e(t.target.result)}}));return await Promise.all(f.map((e=>new Promise(((t,n)=>{var o=e.i,i=r.delete(o);i.onerror=n,i.onsuccess=()=>t()}))))),f.length<o},t.remove=async function(){var e=this.internals.state;return await e.creationPromise,An(this),Cn(this,(async e=>{var t=[e.objectStore(this.internals.storeNames.documentStore),e.objectStore(this.internals.storeNames.writeAheadStore)];return this.schema.attachments&&t.push(e.objectStore(this.internals.storeNames.attachmentsStore)),await Promise.all(t.map((e=>new Promise(((t,n)=>{var r=e.clear();r.onerror=n,r.onsuccess=t}))))),this.close()}))},t.getAttachmentData=async function(e,t){var n=this.internals.state;return await n.creationPromise,An(this),Cn(this,(n=>{var r=n.objectStore(this.internals.storeNames.attachmentsStore),o=On(e,t);return new Promise(((n,i)=>{var s=r.get(o);s.onsuccess=()=>{var r=s.result;r?n(r.data):i("attachment missing documentId: "+e+" attachmentId: "+t)}}))}))},t.close=async function(){return this.closed||(this.closed=(async()=>(await this.internals.state.creationPromise,await Cn(this,(async e=>{})),this.changes$.complete(),async function(e){if(!e.closed&&(e.refCount=e.refCount-1,0===e.refCount))return e.closed=!0,e.storage.indexedDBStates.delete(e.name),e.creationPromise.then((e=>e.close()))}(this.internals.state)))()),this.closed},e}(),Ro=function(){function e(e){this.name=xn,this.rxdbVersion=tn,this.indexedDBStates=new Map,this.settings=e}return e.prototype.createStorageInstance=function(e){return function(e){if(e.schema.keyCompression)throw d("UT5",{args:{params:e}});if((t=e.schema).encrypted&&t.encrypted.length>0||t.attachments&&t.attachments.encrypted)throw d("UT6",{args:{params:e}});var t;if(e.schema.attachments&&e.schema.attachments.compression)throw d("UT7",{args:{params:e}})}(e),async function(e,t,n){var r=gn(t.schema),o=Array.from(r.indexIdByName.values()),i=await jn(e,n,t,[{collectionName:t.collectionName,schema:t.schema,indexIds:o}]);await i.creationPromise;var s={state:i,storeNames:Pn(t.collectionName,t.schema),getIndexableStringByIndexId:r.monadByIndexId,getIndexableStringByIndexNumber:Object.values(r.monadByIndexId),indexIdByName:r.indexIdByName,indexNames:Object.keys(r),indexIds:o,minKnownDocsAmount:0},a=new Bo(e,t.databaseName,t.collectionName,t.schema,s,t.options,n);return await Do(xn,t,a),a}(this,e,Object.assign({},this.settings,e.options))},e}();function Lo(e,t){return _r((function(n,r){var o=0;n.subscribe(kr(r,(function(n){return e.call(t,n,o++)&&r.next(n)})))}))}function Ko(e,t){if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t){if(e.constructor!==t.constructor)return!1;var n,r;if(Array.isArray(e)){if((n=e.length)!==t.length)return!1;for(r=n;0!=r--;)if(!Ko(e[r],t[r]))return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===t.toString();var o=Object.keys(e);if((n=o.length)!==Object.keys(t).length)return!1;for(r=n;0!=r--;)if(!Object.prototype.hasOwnProperty.call(t,o[r]))return!1;for(r=n;0!=r--;){var i=o[r];if(!Ko(e[i],t[i]))return!1}return!0}return e!=e&&t!=t}function qo(e,t){return{connectionId:e.connectionId,answerTo:e.requestId,method:e.method,error:(n=t,{name:n.name,message:n.message,rxdb:n.rxdb,parameters:n.parameters,extensions:n.extensions,code:n.code,url:n.url,stack:n.stack?n.stack.replace(/\n/g," \n "):void 0})};var n}function Fo(e,t){return{connectionId:e.connectionId,answerTo:e.requestId,method:e.method,return:t}}!function(e){var t,n=new Ir;if("undefined"!=typeof self&&"object"==typeof self.onconnect){var r=new Map;self.onconnect=e=>{var t=e.ports[0];t.onmessage=e=>{var o=e.data;r.set(o.connectionId,t),n.next(o)}},t={storage:e.storage,messages$:n,send(e){nn(r,e.connectionId).postMessage(e)}}}else addEventListener("message",(e=>{var t=e.data;n.next(t)})),t={storage:e.storage,messages$:n,send(e){postMessage(e)}};!function(e){var t=new Map;function n(t){if(e.storage)return e.storage.createStorageInstance(t);if(e.database){var n=Array.from(e.database.storageInstances),r=t.collectionName,o=n.find((e=>e.collectionName===r));if(!o)throw console.dir(n),new Error("storageInstance does not exist "+JSON.stringify({collectionName:r}));var i=t.schema;if(!Ko(i,o.schema))throw new Error("Wrong schema "+JSON.stringify({schema:i,existingSchema:o.schema}));return Promise.resolve(o)}throw new Error("no base given")}e.messages$.pipe(Lo((e=>"custom"===e.method))).subscribe((async t=>{if(e.customRequestHandler)try{var n=await e.customRequestHandler(t.params);e.send(Fo(t,n))}catch(n){e.send(qo(t,n))}else e.send(qo(t,new Error("Remote storage: cannot resolve custom request because settings.customRequestHandler is not set")))}));var r=e.fakeVersion?e.fakeVersion:en;e.messages$.pipe(Lo((e=>"create"===e.method))).subscribe((async o=>{if(o.version===r){var i=o.connectionId;if(!Array.isArray(o.params)){var s=o.params,a=s.collectionName,c=[s.databaseName,s.collectionName,s.schema.version].join("|"),u=t.get(c);if(u){if(!Ko(s.schema,u.params.schema))return void e.send(qo(o,new Error("Remote storage: schema not equal to existing storage")))}else try{u={storageInstancePromise:n(s),connectionIds:new Set,params:s},t.set(c,u),await u.storageInstancePromise}catch(t){return void e.send(qo(o,t))}u.connectionIds.add(o.connectionId);var l=[],f=await u.storageInstancePromise;l.push(f.changeStream().subscribe((t=>{var n={connectionId:i,answerTo:"changestream",method:"changeStream",return:t};e.send(n)})));var h=!1;if(e.database){var p=e.database,m=p.collections[a];m?m.onClose.push((()=>v())):p.onClose.push((()=>v()))}l.push(e.messages$.pipe(Lo((e=>e.connectionId===i))).subscribe((async t=>{var n,r=t;if("create"!==r.method&&"custom"!==r.method&&Array.isArray(r.params))try{if("close"===r.method&&e.database)return void e.send(Fo(r,null));if("close"===r.method&&S(u).connectionIds.size>1)return e.send(Fo(r,null)),S(u).connectionIds.delete(i),void l.forEach((e=>e.unsubscribe()));n="getChangedDocumentsSince"!==r.method||f.getChangedDocumentsSince?await f[r.method](r.params[0],r.params[1],r.params[2],r.params[3]):await Zt(f,r.params[0],r.params[1]),"close"!==r.method&&"remove"!==r.method||v(),e.send(Fo(r,n))}catch(t){e.send(qo(r,t))}}))),e.send(Fo(o,"ok"))}}else e.send(qo(o,d("RM1",{args:{mainVersion:o.version,remoteVersion:r}})));function v(){h||(h=!0,l.forEach((e=>e.unsubscribe())),S(u).connectionIds.delete(i),t.delete(c))}}))}(t)}({storage:function(e={}){var t=e.IDBKeyRange?e.IDBKeyRange:IDBKeyRange,n=e.indexedDB?e.indexedDB:indexedDB,r=Object.assign({batchSize:300,transactionDurability:"relaxed"},e,{IDBKeyRange:t,indexedDB:n});return new Ro(r)}({})})})();